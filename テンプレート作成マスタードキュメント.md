# テンプレート作成マスタードキュメント

## 🎯 概要
Instagram投稿生成ツールにおけるテンプレート作成の完全ガイド。K117問題解決を通じて確立された、効率的なテンプレート開発フローを記録。

## 📋 開発フロー

### Phase 1: 問題発見
**症状**: templateOverrides機能は動作するが、コンテンツがタイトルのみ表示
**原因**: データ構造の不一致
- テンプレート期待値: K117のdetailedContent構造（ngExamples/goodExamples等）
- 実際の生成値: content配列形式

### Phase 2: データ構造解析
**実際の生成データ例**:
```typescript
"templateData": {
  "pointNumber": "1",
  "title": "将来成し遂げたいことは何か？🤔", 
  "content": [
    "志望動機作成の第一歩は...",
    "❌NG例：『勉強したい』『成長したい』...",
    "✅GOOD例：『東京を誰もが誇れるまちにしたい』..."
  ],
  "actionItems": []
}
```

### Phase 3: content配列解析機能実装
各テンプレートにparseContent()関数を追加:

#### NgGoodComparisonTemplate
```typescript
const parseContent = () => {
  const parsed = { ngItems: [], goodItems: [], mainText: '' };
  
  contentArray.forEach((content: string) => {
    if (content.includes('❌')) {
      // NG例を抽出
      const ngMatches = content.match(/❌[^✅]*(?=✅|$)/g);
      // 処理...
    }
    if (content.includes('✅')) {
      // GOOD例を抽出  
      const goodMatches = content.match(/✅[^❌]*(?=❌|$)/g);
      // 処理...
    }
  });
  
  return parsed;
};
```

#### CategoryExplanationTemplate
```typescript
// ⭕マークのある項目を抽出
if (content.includes('⭕')) {
  const matches = content.match(/⭕[^⭕]*/g);
  // 処理...
}
```

#### VisionStrengthMatrixTemplate
```typescript
// × マークで対応関係を表現している場合
if (content.includes('×')) {
  const matches = content.match(/([^×\n]+)\s*×\s*([^×\n]+)/g);
  // 処理...
}
```

### Phase 4: デザイン設計原則

#### ❌ 避けるべき要素
- **ハードコード文言**: 「人事は志望動機のココ見てます」等
- **無意味なフレーム**: 保存アイコン、固定ページ番号
- **過度な装飾**: K117真似すぎの複雑フレーム
- **決めつけ解析**: 特定キーワードでの強引な分類

#### ✅ 良いデザイン要素
- **シンプルな構造**: 白背景 + 適切な余白
- **動的コンテンツ**: 生成データのみ使用
- **明確な差別化**: テンプレート間の視覚的区別
- **フォールバック機能**: 解析失敗時の適切な表示

### Phase 5: 最終テンプレート構造

#### 共通パターン
```typescript
export function TemplateComponent({ data }: Props) {
  const contentArray = (data as any).content || [];
  const parsedContent = parseContent(); // 各テンプレート固有
  const { title } = splitTitleForBadge(data.title);

  return (
    <div className="w-full h-full bg-white p-8 flex flex-col">
      {/* タイトル */}
      <div className="text-center mb-8">
        <h1 className="text-3xl font-bold text-gray-900 leading-tight">
          {title}
        </h1>
      </div>

      {/* 解析済みコンテンツ表示 */}
      {/* ... テンプレート固有のレイアウト ... */}

      {/* フォールバック */}
      {/* 解析失敗時のcontent配列そのまま表示 */}
    </div>
  );
}
```

## 🎨 テンプレート別特徴

### NgGoodComparisonTemplate
- **目的**: NG/GOOD例の比較表示
- **解析対象**: ❌、✅マーク
- **レイアウト**: 左右2列グリッド、色分け（赤/緑）
- **特徴**: border-l-4での視覚的区別

### CategoryExplanationTemplate  
- **目的**: カテゴリ別情報の整理表示
- **解析対象**: ⭕マーク
- **レイアウト**: 縦積みボックス、青色統一
- **特徴**: 丸アイコン + 十分な余白

### VisionStrengthMatrixTemplate
- **目的**: 対応関係の表示
- **解析対象**: ×マーク
- **レイアウト**: グラデーションボックス
- **特徴**: 関係性を視覚的に表現

## 🔧 実装のポイント

### 1. 解析の堅牢性
- 正規表現による柔軟なパターンマッチ
- エラー処理とフォールバック
- 重複排除とクリーニング

### 2. TypeScript対応
```typescript
interface ParsedContent {
  ngItems?: string[];
  goodItems?: string[];
  items?: string[];
  pairs?: { left: string; right: string }[];
  mainText: string;
}
```

### 3. レスポンシブ対応
```typescript
// 適切なブレークポイント使用
<div className="grid grid-cols-1 md:grid-cols-2 gap-8">
```

## 📚 学んだ教訓

### ❌ 失敗パターン
1. **K117完全模倣**: フレーム過多でナンセンス
2. **ハードコード濫用**: 柔軟性を損なう
3. **複雑な解析**: 現実的でない自動抽出
4. **デザイン劣化**: 既存より悪い結果

### ✅ 成功パターン
1. **段階的改良**: データ挿入 → 解析 → デザイン
2. **実用第一**: 見た目より機能性重視
3. **シンプル設計**: 必要最小限の要素
4. **フォールバック完備**: 堅牢なエラー処理

## 🚀 今後の展開

### 新テンプレート作成時
1. **生成データ確認**: 実際のcontent配列を分析
2. **解析パターン設計**: 特徴的マーカーを特定
3. **シンプルレイアウト**: 白背景ベースで設計
4. **フォールバック実装**: 解析失敗時の対策

### メンテナンス指針
- content構造変更時の影響調査
- 解析精度の継続的改善
- ユーザビリティテストによる検証
- パフォーマンス最適化

---

**作成日**: 2025-07-27  
**ステータス**: ✅ 完成  
**適用範囲**: 全テンプレート開発