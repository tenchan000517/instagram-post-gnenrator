# テンプレート作成フロー - 段階別ドキュメント参照方式

## 📋 概要

このドキュメントは、新しいテンプレートを体系的に設計・実装するための**段階別ドキュメント参照方式**の完全なフローを定義します。

## 🎯 基本思想

### 従来の問題点
```
❌ 一括考慮方式
Step 1: データ構造・デザイン・実装を同時に考える
Step 2: テンプレート作成開始
→ 複雑さ・混乱・品質劣化・ハードコード濫用
```

### 新方式の原則
```
✅ 段階別ドキュメント参照方式
各ステップで必要最小限の要素のみ考慮
→ 集中力維持・シンプル設計・品質向上・再利用性確保
```

## 📁 重要なパス情報

### テンプレートファイルパス
- **テンプレート保存先**: `/mnt/c/instagram-course/instagram-post-generator/app/components/templates/`
- **既存テンプレート例**: 
  - `NgGoodComparisonTemplate.tsx`
  - `CategoryExplanationTemplate.tsx`
  - `VisionStrengthMatrixTemplate.tsx`

### 型定義パス
- **TemplateTypes**: `/mnt/c/instagram-course/instagram-post-generator/app/components/templates/TemplateTypes.ts`
- **KnowledgeBase型**: `/mnt/c/instagram-course/instagram-post-generator/app/types/knowledgeBase.ts`

### 参考データパス
- **ナレッジベースデータ例**: `/mnt/c/instagram-course/instagram-post-generator/app/data/knowledgeBase/knowledge/K117.json`
- **生成コンテンツ例**: 実際のcontent配列ログを参照

### システムファイルパス
- **index.ts**: `/mnt/c/instagram-course/instagram-post-generator/app/components/templates/index.ts`
- **TemplateRegistry.ts**: `/mnt/c/instagram-course/instagram-post-generator/app/components/templates/TemplateRegistry.ts`

## 🔄 完全フロー（5段階）

### 【段階1】データ構造分析
#### 📚 分析対象
- **実際の生成データのみ**（content配列）
- **既存のナレッジベースJSONは見ない**

#### 🎯 分析手順
1. **content配列の実例収集**
   ```typescript
   // 例：K117の実際の生成データ
   "content": [
     "志望動機作成の第一歩は、将来のビジョンを明確にすること。",
     "❌NG例：『勉強したい』『成長したい』『社会貢献したい』",
     "✅GOOD例：『東京を誰もが誇れるまちにしたい』『新興諸国の経済発展に貢献したい』"
   ]
   ```

2. **構造パターンの特定**
   - どのようなマーカー（❌、✅、⭕、×）が使われているか
   - テキストの構造的特徴は何か
   - 複数のcontent要素間の関係性はどうか

3. **結果記録**
   ```json
   {
     "dataStructure": {
       "primaryMarkers": ["❌", "✅"],
       "contentPattern": "説明文 + NG例 + GOOD例",
       "relationshipType": "対比型"
     }
   }
   ```

#### ⚠️ 重要な制約
- **デザインを考慮しない**
- **実装方法を考慮しない**
- **純粋にデータ構造のみに集中**

---

### 【段階2】解析パターン設計
#### 📚 参照情報
- **段階1の結果**（データ構造分析）
- **既存テンプレートの解析ロジック例**

#### 🎯 設計手順
1. **マーカー抽出パターン設計**
   ```typescript
   // NG/GOOD例の場合
   if (content.includes('❌')) {
     const ngMatches = content.match(/❌[^✅]*(?=✅|$)/g);
     // 処理...
   }
   ```

2. **フォールバック戦略設計**
   ```typescript
   // 解析失敗時の対応
   if (parsedContent.items.length === 0 && contentArray.length > 0) {
     // content配列をそのまま表示
   }
   ```

3. **parseContent関数の設計**
   ```typescript
   const parseContent = () => {
     const parsed = { items: [], mainText: '' };
     // 解析ロジック
     return parsed;
   };
   ```

#### ⚠️ 重要な制約
- **ハードコードは一切使わない**
- **特定キーワードに依存しない**
- **柔軟性を最優先に設計**

---

### 【段階3】テンプレート設計
#### 📚 参照情報
- **段階1-2の結果**
- **既存テンプレートのデザインパターン**

#### 🎯 設計手順

##### Step 3.1: 基本レイアウト設計
```typescript
return (
  <div className="w-full h-full bg-white p-8 flex flex-col">
    {/* タイトル */}
    <div className="text-center mb-8">
      <h1 className="text-3xl font-bold text-gray-900 leading-tight">
        {title}
      </h1>
    </div>

    {/* コンテンツエリア */}
    {/* ... */}
  </div>
);
```

##### Step 3.2: コンテンツ表示パターン選択
1. **対比型（NG/GOOD）**: 左右2列グリッド
2. **列挙型（項目リスト）**: 縦積みボックス
3. **関係型（マトリックス）**: グラデーションボックス

##### Step 3.3: 視覚的差別化設計
- **色彩**: 用途に応じた適切な色分け
- **アイコン**: Lucide Reactの適切なアイコン選択
- **レイアウト**: 他テンプレートとの明確な差別化

#### ⚠️ 重要な制約
- **過度な装飾を避ける**
- **フレーム要素を追加しない**
- **シンプルで実用的なデザインに徹する**

---

### 【段階4】実装・品質保証
#### 📚 参照情報
- **段階1-3の全結果**
- **TypeScript型定義**
- **既存テンプレートの実装例**

#### 🎯 実装手順

##### Step 4.1: 基本実装
```typescript
import React from 'react';
import { TemplateData, splitTitleForBadge } from './TemplateTypes';

interface TemplateProps {
  data: TemplateData;
}

export function NewTemplate({ data }: TemplateProps) {
  const contentArray = (data as any).content || [];
  const parsedContent = parseContent(); // 段階2で設計
  const { title } = splitTitleForBadge(data.title);

  return (
    // 段階3で設計したレイアウト
  );
}
```

##### Step 4.2: フォールバック実装
```typescript
{/* フォールバック: content配列をそのまま表示 */}
{parsedContent.items.length === 0 && contentArray.length > 0 && (
  <div className="flex-1 space-y-4">
    {contentArray.map((content: string, index: number) => (
      <div key={index} className="bg-gray-50 border border-gray-200 p-6 rounded-lg">
        <div className="text-gray-700 whitespace-pre-line">
          {content}
        </div>
      </div>
    ))}
  </div>
)}
```

##### Step 4.3: メタデータ定義
```typescript
// テンプレートメタデータ
export const newTemplateMetadata: TemplateMetadata = {
  id: 'new_template',
  name: '新テンプレート名',
  description: 'テンプレートの説明',
  previewImage: '',
  characterLimits: {
    title: 30,
    content: 100,
    items: 50
  },
  category: 'comparison', // または 'explanation', 'matrix' など
  keywords: ['キーワード'],
  suitableFor: {
    contentTypes: ['適用コンテンツタイプ'],
    genres: ['ナレッジ系', 'ノウハウ系']
  }
};
```

##### Step 4.4: 品質保証テスト
1. **データ解析テスト**: 様々なcontent配列で動作確認
2. **フォールバックテスト**: 解析失敗時の表示確認
3. **レスポンシブテスト**: 異なる画面サイズでの確認

---

### 【段階5】システム登録
#### 📚 参照情報
- **index.ts**: テンプレートコンポーネントのエクスポート
- **TemplateRegistry.ts**: テンプレートメタデータの登録
- **TemplateTypes.ts**: 型定義の確認

#### 🎯 登隂手順

##### Step 5.1: index.tsへの登録
1. **エクスポート追加**
   ```typescript
   export { NewTemplate } from './NewTemplate'
   ```

2. **インポート追加**
   ```typescript
   import { NewTemplate } from './NewTemplate'
   ```

3. **templateComponentsオブジェクトへ追加**
   ```typescript
   export const templateComponents = {
     // ...既存テンプレート,
     'new_template': NewTemplate
   }
   ```

##### Step 5.2: TemplateRegistry.tsへの登録
1. **メタデータインポート**
   ```typescript
   import { newTemplateMetadata } from './NewTemplate'
   ```

2. **templateRegistryへ追加**
   ```typescript
   export const templateRegistry: Record<TemplateType, TemplateMetadata> = {
     // ...既存テンプレート,
     new_template: newTemplateMetadata
   }
   ```

##### Step 5.3: TemplateTypes.tsの確認
```typescript
export type TemplateType = 
  // ...既存タイプ
  | 'new_template'  // 新テンプレート追加
```

#### ⚠️ 重要な制約
- **メタデータがないと編集機能が動作しない**
- **3つのファイルすべてを更新する必要がある**
- **テンプレートIDは一意であること**

## 🚨 段階別制約・禁止事項

### 【段階1】制約
- [ ] **デザインを考慮しない**
- [ ] **実装方法を考慮しない**
- [ ] **既存テンプレートと比較しない**
- [ ] **純粋にデータ構造のみに集中**

### 【段階2】制約  
- [ ] **ハードコードを一切使わない**
- [ ] **特定キーワードに依存しない**
- [ ] **デザインを考慮しない**
- [ ] **柔軟性を最優先に設計**

### 【段階3】制約
- [ ] **過度な装飾を避ける**
- [ ] **フレーム要素を追加しない**
- [ ] **実装の詳細を考慮しない**
- [ ] **シンプルで実用的なデザインに徹する**

### 【段階4】制約
- [ ] **段階1-3の結果に忠実に従う**
- [ ] **新たなデザイン変更を行わない**
- [ ] **品質保証を徹底する**
- [ ] **フォールバックを必ず実装**
- [ ] **メタデータを必ず定義**

### 【段階5】制約
- [ ] **3つのファイルすべてを更新**
- [ ] **テンプレートIDの一意性を確認**
- [ ] **メタデータの整合性を確認**
- [ ] **既存テンプレートとの衝突を避ける**

## 📊 実践例：K117フロー完全版

### 【段階1】データ構造分析
**実際の生成データ**:
```
"content": [
  "志望動機作成の第一歩は、将来のビジョンを明確にすること。",
  "❌NG例：『勉強したい』『成長したい』",
  "✅GOOD例：『東京を誰もが誇れるまちにしたい』"
]
```

**分析結果**: NG/GOOD対比型、❌✅マーカー使用

### 【段階2】解析パターン設計
```typescript
const parseContent = () => {
  const parsed = { ngItems: [], goodItems: [], mainText: '' };
  
  contentArray.forEach((content: string) => {
    if (content.includes('❌')) {
      // NG例抽出ロジック
    }
    if (content.includes('✅')) {
      // GOOD例抽出ロジック
    }
    // その他テキスト処理
  });
  
  return parsed;
};
```

### 【段階3】テンプレート設計
- **レイアウト**: 左右2列グリッド
- **色分け**: NG(赤)、GOOD(緑)
- **アイコン**: X、Check

### 【段階4】実装・品質保証
- NgGoodComparisonTemplate.tsx として実装
- フォールバック機能完備
- レスポンシブ対応
- メタデータ定義完了

### 【段階5】システム登録
- index.tsにエクスポート追加
- templateComponentsに'ng_good_comparison'追加
- TemplateRegistry.tsにメタデータ登録
- TemplateTypes.tsに型定義確認

## ✅ 品質保証チェックリスト

### 各段階完了時チェック
- [ ] **段階1**: データ構造とパターンが明確に特定されている
- [ ] **段階2**: 解析ロジックが柔軟で堅牢に設計されている
- [ ] **段階3**: デザインがシンプルで実用的である
- [ ] **段階4**: 実装が完全でテスト済みである
- [ ] **段階5**: システム登録が完了し編集機能が動作する

### 最終品質チェック
- [ ] **データ対応**: 様々なcontent配列に対応できる
- [ ] **フォールバック**: 解析失敗時も適切に表示される
- [ ] **差別化**: 他テンプレートと明確に区別される
- [ ] **シンプル性**: 無駄な要素がない
- [ ] **再利用性**: 他のナレッジベースでも使用可能
- [ ] **編集機能対応**: 文字数制限などが正しく機能する

## 🎯 このフローの利点

### 1. **集中力維持**
- 一度に一つの要素に集中
- 認知負荷の軽減
- 設計精度の向上

### 2. **品質保証**
- 段階的な品質チェック
- ハードコード排除の徹底
- シンプル性の確保

### 3. **再利用性**
- 汎用的な設計パターン
- 柔軟な解析ロジック
- 標準化されたアプローチ

### 4. **保守性**
- 明確な設計思想
- 段階的な改善可能
- トラブルシューティング容易

## 🔄 運用指針

### 新テンプレート作成時
1. **段階を厳密に分離して実施**
2. **制約を厳格に守る**
3. **各段階の結果を明確に記録**

### 既存テンプレート改善時
1. **段階1から再分析**
2. **データ構造変化への対応**
3. **フォールバック機能の見直し**

### 品質維持
1. **定期的な動作確認**
2. **新しいナレッジベースでのテスト**
3. **ユーザビリティの継続評価**

---

**作成日**: 2025-07-27  
**バージョン**: 1.1  
**更新内容**: 段階5（システム登録）を追加  
**基準**: K117テンプレート完全実装時点  
**重要度**: 最高 - 全テンプレート開発の標準プロセス  
**適用範囲**: 全テンプレート作成・改善作業