# 新しいフロー要件定義書

## 🎯 改善の背景

現在のシステムは「動くが稚拙」なレベルで、以下の問題があります：
- 単純な文字列マッチングによる戦略分析
- テンプレート選択の精度不足
- コンテンツの意味的理解の欠如
- デバッグコードの混在

## 📋 新しいフロー構造

### **現在のフロー：**
```
入力 → 戦略分析 → 生成（Gemini+固定処理）
```

### **新しいフロー：**
```
①入力 → ②Gemini高品質コンテンツ生成 → ③コンテンツ承認・再生成 → ④表現的テンプレートマッチング → ⑤個別テンプレート変更 → ⑥コンテンツ直接編集 → ⑦キャプション・ハッシュタグ生成
```

## 🔧 各ステップの詳細要件

### **①入力**
- **変更点**: マッチング等は一切行わない
- **要件**: 純粋な入力のみ受け付け、全てGeminiに委ねる
- **実装**: ContentInput.tsxをシンプル化

### **②Gemini高品質コンテンツ生成**
- **重要ルール**: 
  - 憶測・推測は絶対に含めない
  - 事実ベースのコンテンツのみ生成
  - 少ない行でも質の高いコンテンツ作成
- **品質目標**: 先ほど保存したコンテンツのような高品質なアウトプット
- **改善点**: 小学生でもわかるようなものをもっとハイクオリティに

### **③コンテンツ承認・再生成**
- **機能要件**:
  - 全体再生成
  - 部分再生成（特定ページのみ）
  - 例：1ページ分だけ再生成
- **UX要件**: ユーザーの許可を必ず取る
- **実装**: ContentApprovalコンポーネント

### **④表現的テンプレートマッチング**
- **重要な変更**: ジャンル的内容マッチングではなく表現的マッチング
- **要件**: 各ページでどのテンプレートが適切かを表現方法で判断
- **実装**: TemplateMatchingService

### **⑤個別テンプレート変更**
- **機能要件**: 各ページのテンプレートを個別に変更可能
- **UX要件**: 適切な箇所に適切に配置できる
- **実装**: EditablePostGenerator

### **⑥コンテンツ直接編集**
- **機能要件**: 
  - 各ページの一部分を直接編集可能
  - 例：3ページ目のタイトルのみ編集
- **範囲**: タイトル、本文、項目など細かい単位で編集
- **実装**: インライン編集機能

### **⑦キャプション・ハッシュタグ生成**
- **タイミング**: 完成したコンテンツを元に生成
- **要件**: 最適化された出力
- **実装**: FinalCaptionGenerator

## 🏗️ 実装アプローチ

### **新しいコンポーネント構成**
1. **ContentInput.tsx** - シンプル化（既存改修）
2. **ContentGeneratorコンポーネント** - Gemini生成（新規）
3. **ContentApprovalコンポーネント** - 承認・再生成（新規）
4. **TemplateMatchingService** - 表現的マッチング（新規）
5. **EditablePostGenerator** - 編集可能な生成器（新規）
6. **FinalCaptionGenerator** - 最終キャプション生成（新規）

### **保持する機能**
- 保存機能
- スナップショット機能
- ビューポートのロジック
- 既存の12種類のテンプレート

## 🎨 品質向上の具体的要件

### **コンテンツ品質**
- 先ほど作成したカルーセル投稿案レベルの品質
- 実践的で具体的な内容
- 学生にとって価値のある情報

### **テンプレート選択精度**
- 表現形式に基づいた選択
- 列挙型→リスト形式のコンテンツ
- 説明型→詳細解説のコンテンツ
- ストーリー型→体験談のコンテンツ

### **UX改善**
- 各ステップでユーザーの承認を得る
- 細かい編集が可能
- 直感的な操作性

## 🚨 重要な制約

1. **事実ベース**: 憶測・推測は一切禁止
2. **品質第一**: 小学生レベルの内容を排除
3. **承認制**: ユーザーの許可なしに進行しない
4. **編集可能**: 細かい単位で編集できること
5. **表現的マッチング**: 内容ではなく表現方法でテンプレート選択

## 🎯 成功指標

- 生成されるコンテンツの品質向上
- ユーザーの編集回数の削減
- テンプレート選択の精度向上
- 全体的なUXの改善

## 📝 実装優先順位

1. **高**: ②Gemini高品質コンテンツ生成
2. **高**: ③コンテンツ承認・再生成
3. **中**: ④表現的テンプレートマッチング
4. **中**: ⑤個別テンプレート変更
5. **低**: ⑥コンテンツ直接編集
6. **低**: ⑦キャプション・ハッシュタグ生成

## 🔄 移行計画

1. 既存システムの機能を維持しながら段階的に実装
2. 各ステップごとに動作確認
3. 最終的に旧システムを置き換え

---

**注意**: このドキュメントは新しいフロー実装の基本設計書です。実装時には詳細な技術仕様書を別途作成します。