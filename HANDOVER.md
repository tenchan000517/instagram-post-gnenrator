# 📋 Instagram Post Generator - 次世代Claude Code引き継ぎ書

## 🚨 現在の状況

### **完了済み改善項目**

1. ✅ **テンプレート選択改善**: 全12種類のテンプレートが選択可能に
2. ✅ **AI再配置実装**: ContentLayoutServiceを統合
3. ✅ **ストーリー型テンプレート修正**: ハードコードテキストを削除
4. ✅ **コンテンツ生成密度向上**: プロンプト改善で密度・価値を向上
5. ✅ **503エラー対策**: gemini-2.0-flash-liteに変更で安定化
6. ✅ **モックデータ削除**: 問題を隠す害悪なモックデータを完全削除
7. ✅ **ハッシュタグ設定更新**: 大・中・小カテゴリに新しいハッシュタグを追加

### **現在の根本問題**

**NEW_FLOW_DESIGN.mdで指摘されている核心問題:**
- AIが豊富なコンテンツを生成
- JavaScriptが「抽出・分解・再構築」で情報を削る
- テンプレート再配置時に削られたコンテンツしか使用されない
- 生のコンテンツ全体が活用されていない

## 🎯 現在の実装状況

### **技術スタック**
- **AI**: Gemini 2.0 Flash Lite (安定稼働中)
- **フロー**: 新フロー実装済み (NewFlowPostGenerator.tsx)
- **テンプレート**: 12種類全て選択可能
- **再配置**: ContentLayoutService実装済み

### **データ構造**
```typescript
interface GeneratedPage {
  pageNumber: number
  templateType: TemplateType
  templateData: TemplateData
  content: { ... } // 削られたコンテンツ
  rawContent?: string // 🚨 追加: 生のコンテンツ（未実装）
}
```

## 🔧 緊急対応が必要な問題

### **1. 生のコンテンツ保存が未実装**
- **問題**: rawContentフィールドは追加したが、実際の保存処理が未実装
- **影響**: テンプレート再配置時に削られたコンテンツしか使用されない
- **対策**: AI生成レスポンスをそのままrawContentに保存する処理を追加

### **2. テンプレート再配置で削られたコンテンツを使用**
- **問題**: EditablePostGenerator.tsxのhandleTemplateChangeで削られたpage.contentを使用
- **影響**: 再配置時に情報が更に劣化
- **対策**: page.rawContentを使用するように修正

### **3. AI生成レスポンスのパース処理**
- **問題**: parseGeneratedContentで生のレスポンスをrawContentに保存していない
- **影響**: 生のコンテンツが失われる
- **対策**: パース時に生のレスポンスをrawContentに保存

## 🚀 実装すべき優先順位

### **最優先 (即座対応)**
1. **生のコンテンツ保存**: parseGeneratedContentでrawContentを保存
2. **再配置修正**: handleTemplateChangeでrawContentを使用
3. **動作確認**: 実際のコンテンツ削れ問題が解決されるかテスト

### **次優先**
4. **キャプション・ハッシュタグ再生成**: 実装済みだが仮実装
5. **部分編集機能**: より細かい編集が可能に
6. **プレビュー機能**: テンプレート選択前の確認

## 🗂️ 重要ファイル一覧

### **修正が必要なファイル**
- `/app/services/contentGeneratorService.ts` - 生のコンテンツ保存
- `/app/components/EditablePostGenerator.tsx` - 再配置時の処理
- `/app/services/contentLayoutService.ts` - 配置ロジック

### **参考文書**
- `/NEW_FLOW_DESIGN.md` - 設計思想と制約
- `/HANDOVER.md` - 本引き継ぎ書（更新済み）
- `/NOTES.md` - 現在の開発状況

## 🚨 重要な制約

### **AI最適配置の制約**
- **コンテンツの改変は一切しない**
- **付け足しや文言変更は禁止**
- **純粋にテンプレートの適切な場所に配置するだけ**

### **開発方針**
- **問題を隠さない**: エラーは明確に表示
- **モックデータ禁止**: 実際のAI生成のみ使用
- **Flash Lite継続**: 安定稼働中のため変更不要

## 🎯 次世代Claude Codeへの指示

### **まず最初に:**
1. 生のコンテンツ保存処理を実装
2. テンプレート再配置で生のコンテンツを使用
3. 実際の削れ問題が解決されるかテスト

### **これが完了すれば:**
NEW_FLOW_DESIGN.mdで指摘されている根本問題が解決され、AIが生成した豊富なコンテンツが完全に活用されるようになります。

## 📋 プロジェクト概要

### **基本情報**
- **プロジェクト名**: Instagram Post Generator
- **技術スタック**: Next.js (React), TypeScript, Tailwind CSS, Gemini AI, html2canvas
- **ディレクトリ**: `/mnt/c/instagram-course/instagram-post-generator`
- **対象ジャンル**: キャリア・就活・インターンシップ
- **目的**: リサーチ結果から高品質なInstagram投稿を自動生成

### **現在のフロー**
```
①入力 → ②Gemini高品質コンテンツ生成 → ③コンテンツ承認・再生成 → ④推奨テンプレート表示 → ⑤個別テンプレート変更（全てのテンプレート選択可能） → ⑥選択されたテンプレートに合わせて生成されたコンテンツを改変せずにテンプレートに対してAI最適配置実行 → ⑦コンテンツ直接部分編集 → ⑧完成・ダウンロード → ⑨キャプション・ハッシュタグ再生成（オプション）
```

---

**次世代Claude Codeは上記の緊急対応問題を優先的に解決し、生のコンテンツ保存によるコンテンツ削れ問題の根本解決を実装してください。**

**NEW_FLOW_DESIGN.mdの設計思想と制約を遵守し、既存のサービスを活用してください。**