# 🚀 ナレッジベース生成システム実装実行計画書

**作成日**: 2025-07-22  
**目的**: コピペ実行で完全実装を可能にする詳細実行プラン

---

## 📚 **必須参照ドキュメント**（全フェーズ共通）

**実行前に必ず以下を参照してください:**

```
/mnt/c/instagram-course/instagram-post-generator/docs/KNOWLEDGE_BASE_SYSTEM_ANALYSIS_MEMO.md
/mnt/c/instagram-course/instagram-post-generator/docs/IMPLEMENTATION_ROADMAP.md
/mnt/c/instagram-course/instagram-post-generator/CLAUDE.md
/mnt/c/instagram-course/instagram-post-generator/NOTES.md
```

**重要な設計思想の確認:**
- ナレッジ = 実際の困った→解決した実例（Phase 6）
- 投稿タイプ = フィルタリング機能のみ（Phase 7）
- ナレッジ自体が最適構造を内包（Phase 7）
- 事実以外の情報追加は厳禁

---

## 🎯 **Phase A1: 既存データの詳細分析と対応可能性調査**

### **実行プロンプト A1**

```
【参照必須ドキュメント】
- /mnt/c/instagram-course/instagram-post-generator/docs/KNOWLEDGE_BASE_SYSTEM_ANALYSIS_MEMO.md
- /mnt/c/instagram-course/instagram-post-generator/docs/IMPLEMENTATION_ROADMAP.md
- /mnt/c/instagram-course/instagram-post-generator/CLAUDE.md

【タスク概要】
既存のproblemSolutionPairs.jsonとpageStructureMatching.jsonを詳細分析し、ナレッジベース生成システムPhase 7設計思想（ナレッジ自体が最適構造を内包）に対応可能かを調査する。

【具体的実行内容】
1. problemSolutionPairs.jsonの完全読み込みと構造分析
   - 116ナレッジの詳細内容確認
   - 各ナレッジが持つストーリー性・フロー構造の有無確認
   - ペルソナ-ナレッジ関係のマッピング状況確認

2. pageStructureMatching.json vs pageStructures/の対応状況確認
   - 66パターン定義の詳細確認
   - 実際の5pageStructureファイルとの対応関係
   - 各ナレッジに最適なページ構造特定の可能性調査

3. ペルソナ-投稿タイプ関係の現状分析
   - 116ペルソナの投稿タイプ分類可能性確認
   - ターゲット-ペルソナ関係の整合性チェック

【出力要求】
以下の形式でデータ現状分析レポートを作成:
- 各ナレッジの構造情報保有状況一覧
- ペルソナ-ナレッジ関係マッピング表
- Phase 7設計思想実現のための不足要素リスト
- 対応可能範囲と追加開発必要範囲の明確な分類
```

---

## 🎯 **Phase A2: 既存システムでは実現できない機能のギャップ分析**

### **実行プロンプト A2**

```
【参照必須ドキュメント】
- /mnt/c/instagram-course/instagram-post-generator/docs/KNOWLEDGE_BASE_SYSTEM_ANALYSIS_MEMO.md
- /mnt/c/instagram-course/instagram-post-generator/docs/IMPLEMENTATION_ROADMAP.md
- /mnt/c/instagram-course/instagram-post-generator/app/components/ui/KnowledgeBaseSelector.tsx
- /mnt/c/instagram-course/instagram-post-generator/app/services/pageStructureAnalyzer.ts

【タスク概要】
Phase A1の結果を踏まえ、確定フロー（投稿タイプ→ターゲット→ユーザー入力→AI類似度検索→ナレッジ選択→投稿タイプフィルタリング→構造確定）を実現するために不足している機能を特定する。

【具体的実行内容】
1. UI層の対応不足調査
   - 現在の5ターゲット（P001-P005）vs 必要な12ターゲット（4投稿タイプ×3）
   - 抽象的TypeID（001-004）vs 具体的投稿タイプの表示
   - KnowledgeBaseSelectorの改修必要範囲特定

2. AI類似度検索機能の不在確認
   - ユーザー入力とナレッジの類似度計算機能の有無
   - スコア付け・推奨表示機能の不在確認
   - 必要な技術要件（NLP、ベクトル計算等）の特定

3. ナレッジ構造保持システムの不足確認
   - 現在のテンプレート固定化システムの制約確認
   - ナレッジ固有フロー認識・活用機能の不在
   - 動的構造決定システムの開発必要性確認

4. 投稿タイプフィルタリング機能の不在
   - ペルソナの投稿タイプ適合判定機能の不存在確認
   - 動的フィルタリングシステムの開発必要性

【出力要求】
- 開発必要機能の詳細リスト（優先度付き）
- 各機能の技術要件定義
- 実装難易度とコスト見積もり
- 既存システム改修 vs 新規開発の判定結果
```

---

## 🎯 **Phase B1: ペルソナ重複チェックと品質評価による整理**

### **実行プロンプト B1**

```
【参照必須ドキュメント】
- /mnt/c/instagram-course/instagram-post-generator/docs/KNOWLEDGE_BASE_SYSTEM_ANALYSIS_MEMO.md (Phase 5: 投稿タイプ別品質評価基準)
- /mnt/c/instagram-course/instagram-post-generator/app/services/knowledgeBase/data/problemSolutionPairs.json

【タスク概要】
同一ターゲット内でのペルソナ重複を検出し、投稿タイプ別品質評価基準に基づいて整理・統合する。

【重要な制約条件】
- ❌ NG: 同一ターゲット内でのペルソナ重複
- ✅ OK: 異なるターゲット（投稿タイプ）間でのペルソナ共有
- 品質評価: 困りごとの明確性 × 求める答えとナレッジ内容の一致性

【具体的実行内容】
1. 投稿タイプ別ペルソナ品質評価基準の適用
   - キャリア悩み解決: 困りごと明確性 × 共感型ナレッジ適合度
   - スキルアップガイド: 困りごと明確性 × 教育型ナレッジ適合度  
   - 業界情報まとめ: 困りごと明確性 × 情報型ナレッジ適合度
   - 効率アップテクニック: 困りごと明確性 × 実用型ナレッジ適合度

2. 同一ターゲット内重複ペルソナの検出
   - 各ペルソナの所属ターゲット分析
   - 重複パターンの特定

3. 品質スコア算出と統合・削除判定
   - 高品質ペルソナの採用
   - 低品質ペルソナの削除または統合

【出力要求】
- ペルソナ重複検出レポート
- 投稿タイプ別品質評価結果
- クリーンアップ後ペルソナ一覧
- 削除・統合されたペルソナの記録
```

---

## 🎯 **Phase B2: 116ペルソナの12ターゲット再分類・紐づけ**

### **実行プロンプト B2**

```
【参照必須ドキュメント】
- /mnt/c/instagram-course/instagram-post-generator/docs/KNOWLEDGE_BASE_SYSTEM_ANALYSIS_MEMO.md (確定フロー・投稿タイプ定義)
- Phase B1の出力結果（クリーンアップ後ペルソナ一覧）

【タスク概要】
Phase B1でクリーンアップされたペルソナを、4投稿タイプ×3ターゲット=12ターゲットの新構造に再分類・紐づけする。

【投稿タイプ定義（再確認）】
1. キャリアの悩み解決法（感情・共感重視）
2. スキルアップガイド（教育・学習重視）
3. 業界・企業情報まとめ（情報・データ重視）
4. 効率アップテクニック（実用・効率重視）

【各投稿タイプのターゲット例】
- キャリア悩み: 就活不安学生、仕事ストレス、転職迷い
- スキルアップ: 差をつけたい学生、新スキル習得、キャリアアップ
- 業界情報: 業界研究就活生、転職先探索、企業選択迷い
- 効率アップ: AI活用希望、生産性向上、時短結果重視

【具体的実行内容】
1. クリーンアップ済みペルソナの投稿タイプ分類
   - 各ペルソナの「困りごと」と「求める答え」分析
   - 4投稿タイプのいずれに最適かを判定

2. 各投稿タイプ内での3ターゲット分類
   - ペルソナの特性に基づく3グループ化
   - ターゲット名称と特性定義の作成

3. ペルソナ-ターゲット-投稿タイプの3者関係整合性確保
   - 矛盾のないマッピング関係構築
   - データ整合性チェック

【出力要求】
- 12ターゲットの定義と特性説明
- 全ペルソナの新分類結果
- ペルソナ-ターゲット-投稿タイプマッピング表
- データ整合性検証レポート
```

---

## 🎯 **Phase B3: ナレッジのページ構成・テンプレート構造分析**

### **実行プロンプト B3**

```
【参照必須ドキュメント】
- /mnt/c/instagram-course/instagram-post-generator/docs/KNOWLEDGE_BASE_SYSTEM_ANALYSIS_MEMO.md (Phase 7: ナレッジの構造的特性)
- /mnt/c/instagram-course/instagram-post-generator/app/services/knowledgeBase/data/problemSolutionPairs.json
- Phase A1の出力結果（データ現状分析レポート）

【タスク概要】
各ナレッジが持つ固有のストーリーフロー・ページ構成を分析し、「ナレッジ自体が最適構造を内包」の設計思想を実現するための構造データを抽出する。

【重要な設計思想（再確認）】
- ナレッジ = 既にストーリー性・構成を持つ完成されたコンテンツ
- 投稿タイプ別の繊細な心理フロー（共感×5→行動、概要→手順×4等）
- AIDMA・起承転結等の効果的表現順序を保持

【具体的実行内容】
1. 各ナレッジのストーリーフロー分析
   - 116ナレッジの内容構造を詳細分析
   - 感情の流れ・説得構造の特定
   - AIDMA・起承転結等のパターン識別

2. テンプレート構造の類型化
   - 共感×5→行動型の発見・確認
   - 概要→手順×4型の発見・確認
   - その他独自パターンの発見・分類

3. ナレッジ-最適構造の対応関係構築
   - 各ナレッジに最適なページ数・構成の決定
   - 最適表現順序の特定
   - 構造保持のための必要情報整理

【出力要求】
- 全116ナレッジの構造分析結果
- テンプレート構造類型一覧
- ナレッジ-最適構造対応表
- 構造保持システム実装のための要件定義
```

---

## 🎯 **Phase C1: KnowledgeBaseSelectorの全面改修**

### **実行プロンプト C1**

```
【参照必須ドキュメント】
- /mnt/c/instagram-course/instagram-post-generator/docs/KNOWLEDGE_BASE_SYSTEM_ANALYSIS_MEMO.md
- /mnt/c/instagram-course/instagram-post-generator/app/components/ui/KnowledgeBaseSelector.tsx
- Phase B2の出力結果（12ターゲット定義・ペルソナマッピング表）

【タスク概要】
現在の抽象的TypeID×5ターゲット表示から、具体的4投稿タイプ×12ターゲット表示へのUI全面改修を実行する。

【改修要件】
1. 投稿タイプ選択UI
   - 抽象的「001-004」→ 具体的「キャリア悩み解決法」等4タイプ
   - 各投稿タイプの説明・特徴表示

2. ターゲット選択UI  
   - 選択された投稿タイプに応じた3ターゲットのみ表示
   - 12ターゲット全体での動的フィルタリング

3. 選択状態管理の改良
   - 投稿タイプ選択時のターゲット自動フィルタリング
   - 状態遷移の最適化

【具体的実行内容】
1. 現在のKnowledgeBaseSelector.tsxの完全読み込み・理解
2. TYPE_OPTIONS の4投稿タイプへの置き換え
3. TARGET_OPTIONS の12ターゲットへの拡張・動的表示対応
4. 選択フロー・状態管理の実装改修
5. UI/UX の改善（説明文追加、視覚的改善等）

【技術要件】
- React/TypeScript
- 状態管理最適化
- 既存コンポーネント構造の保持
- レスポンシブ対応

【出力要求】
- 改修されたKnowledgeBaseSelector.tsx
- 新しい型定義（必要に応じて）
- 改修内容の説明ドキュメント
- テスト用サンプルデータ
```

---

## 🎯 **Phase C2: AI類似度検索ロジックの実装**

### **実行プロンプト C2**

```
【参照必須ドキュメント】
- /mnt/c/instagram-course/instagram-post-generator/docs/KNOWLEDGE_BASE_SYSTEM_ANALYSIS_MEMO.md (確定フロー)
- /mnt/c/instagram-course/instagram-post-generator/app/services/knowledgeBase/
- Phase B3の出力結果（ナレッジ構造分析結果）

【タスク概要】
ユーザー入力（どういう投稿をしたいか）とフィルタリング済みナレッジ群の類似度計算・推奨機能を実装する。

【機能要件】
1. テキスト類似度計算
   - ユーザー入力文とナレッジ内容の意味的類似度
   - スコア算出（0.0-1.0）

2. 推奨ナレッジの優先順位表示
   - 類似度スコア順ソート
   - 上位3-5件の推奨表示
   - スコア・理由の表示

3. ユーザー最終選択インターフェース
   - 推奨結果からの選択UI
   - 手動検索・選択の代替手段

【具体的実行内容】
1. 類似度計算サービスの新規作成
   - ベクトル計算・コサイン類似度等のアルゴリズム選択
   - Gemini AI APIを活用した意味的類似度計算
   - 計算精度とパフォーマンスの最適化

2. 推奨エンジンの実装
   - フィルタリング済みナレッジ群からの類似度計算
   - スコア閾値設定・推奨件数調整
   - 推奨理由の自動生成

3. UIコンポーネントの実装
   - 類似度結果表示コンポーネント
   - ユーザー選択インターフェース
   - ローディング・エラーハンドリング

【技術要件】
- NLP処理（テキスト前処理・ベクトル化）
- Gemini AI API活用
- 非同期処理・パフォーマンス最適化
- React/TypeScript UI実装

【出力要求】
- SimilaritySearchService.ts（類似度計算サービス）
- RecommendationEngine.ts（推奨エンジン）
- SimilarityResultsUI.tsx（結果表示UI）
- 実装テスト・動作確認結果
```

---

## 🎯 **Phase C3: プロンプト改善・最適化**

### **実行プロンプト C3**

```
【参照必須ドキュメント】
- /mnt/c/instagram-course/instagram-post-generator/docs/KNOWLEDGE_BASE_SYSTEM_ANALYSIS_MEMO.md (Phase 6,7)
- /mnt/c/instagram-course/instagram-post-generator/app/services/pageStructureAnalyzer.ts
- Phase B3の出力結果（ナレッジ構造分析結果）

【タスク概要】
ナレッジ構造尊重・事実厳守の制約に基づき、投稿タイプ別最適化プロンプトを実装する。

【重要な制約（再確認）】
- ❌ 憶測・推測・事実に基づかない情報の追加は厳禁
- ✅ ナレッジの持つ構造と事実情報のみを使用
- ✅ ユーザー意図に合わせた表現調整のみ

【改善要件】
1. ナレッジ構造保持指示
   - ナレッジ固有のストーリーフロー維持
   - 感情の流れ・説得構造の保持
   - ページ構成・表現順序の尊重

2. 事実厳守指示
   - ナレッジにない情報の追加禁止
   - 推測・想像による補完禁止
   - データの改変・誇張禁止

3. 投稿タイプ別表現最適化
   - キャリア悩み: 共感・感情的サポート重視
   - スキルアップ: 教育的・体系的表現
   - 業界情報: 客観的・データ重視表現
   - 効率アップ: 実用的・即効性重視表現

【具体的実行内容】
1. 現在のプロンプトテンプレートの分析・問題点特定
2. 投稿タイプ別プロンプトテンプレートの作成
3. ナレッジ構造保持のためのプロンプト構造設計
4. 事実厳守のための制約指示追加
5. ユーザー意図反映のためのプロンプト調整機能

【出力要求】
- 投稿タイプ別プロンプトテンプレート（4種類）
- PromptGenerator.ts（プロンプト生成サービス）
- プロンプト品質検証テスト
- 改善前後の比較・効果測定結果
```

---

## 🎯 **Phase C4: 困った→解決生成フローのシステム実装**

### **実行プロンプト C4**

```
【参照必須ドキュメント】
- /mnt/c/instagram-course/instagram-post-generator/docs/KNOWLEDGE_BASE_SYSTEM_ANALYSIS_MEMO.md (確定フロー)
- Phase C1-C3の出力結果（改修UI・類似度検索・プロンプト改善）

【タスク概要】
確定フローの完全なシステム統合実装を行う。

【確定フロー（再確認）】
1. 投稿タイプ選択（4種類）
2. ターゲット選択（選択投稿タイプに紐づく3ターゲット）
3. ペルソナ自動フィルタリング（選択ターゲットに紐づくペルソナ群）
4. ナレッジ自動フィルタリング（フィルタされたペルソナに紐づくナレッジ群）
5. ユーザー入力投入
6. AI類似度検索（フィルタされたナレッジ群 vs ユーザー入力）
7. 最適ナレッジ選択（AIスコア付き推奨からユーザー選択）
8. 投稿タイプによるペルソナフィルタリング
9. 3要素同時確定（ページ構成・テンプレート・最終ペルソナ・コンテンツ）

【具体的実行内容】
1. フロー管理サービスの実装
   - 各段階の状態管理
   - 段階間データ受け渡し
   - エラーハンドリング・ロールバック

2. フィルタリング機能の統合実装
   - 投稿タイプ→ターゲット→ペルソナ→ナレッジの段階的絞り込み
   - 投稿タイプによるペルソナ最終フィルタリング
   - フィルタリング結果の整合性確保

3. 統合コントローラーの実装
   - UI操作からコンテンツ生成までの一貫した制御
   - 各Phase C1-C3実装機能の統合
   - パフォーマンス最適化・並列処理

4. エラーハンドリング・ユーザーフィードバック
   - 各段階でのエラー検出・対処
   - ユーザーへの適切なフィードバック表示
   - デバッグ・ログ機能

【技術要件】
- 状態管理（Redux/Zustand等）
- 非同期処理・Promise連鎖
- エラー境界・例外処理
- TypeScript型安全性確保

【出力要求】
- KnowledgeBaseFlowController.ts（統合コントローラー）
- FilteringService.ts（フィルタリングサービス）
- 統合テスト・エンドツーエンドテスト
- フロー動作確認・デバッグレポート
```

---

## 🎯 **Phase C5: ナレッジ自体からページ構成決定システム**

### **実行プロンプト C5**

```
【参照必須ドキュメント】
- /mnt/c/instagram-course/instagram-post-generator/docs/KNOWLEDGE_BASE_SYSTEM_ANALYSIS_MEMO.md (Phase 7)
- Phase B3の出力結果（ナレッジ構造分析結果・最適構造対応表）

【タスク概要】
固定的な6種類テンプレートから脱却し、各ナレッジが持つ固有構造に基づく動的ページ構成決定システムを実装する。

【設計思想（再確認）】
- ナレッジの数だけ多様なテンプレート構造が存在
- 各ナレッジが持つ最適フローを尊重
- 感情の起伏・タイミング・心理的説得構造の保持

【実装要件】
1. ナレッジ構造解析エンジン
   - Phase B3で分析したナレッジ構造データの活用
   - ストーリーフロー・感情パターンの自動認識
   - 最適ページ数・構成の動的決定

2. 動的テンプレート生成システム
   - ナレッジ固有構造に基づくテンプレート作成
   - 柔軟なページ構成（3-6ページ可変）
   - テンプレート要素の動的配置

3. 構造保持・品質保証機能
   - ナレッジの完整性チェック
   - 構造破綻の検出・修正
   - 生成品質のモニタリング

【具体的実行内容】
1. KnowledgeStructureAnalyzer.ts の実装
   - ナレッジ構造データの読み込み・解析
   - 構造パターンマッチング・分類
   - 最適構成の自動決定アルゴリズム

2. DynamicTemplateGenerator.ts の実装
   - 構造に基づく動的テンプレート生成
   - ページ要素の柔軟配置
   - テンプレートキャッシュ・最適化

3. 既存pageStructuresシステムとの統合
   - 従来の固定テンプレートから動的システムへの移行
   - 互換性確保・段階的移行計画
   - パフォーマンス比較・改善

【出力要求】
- KnowledgeStructureAnalyzer.ts（構造解析エンジン）
- DynamicTemplateGenerator.ts（動的生成システム）
- 動的vs固定テンプレートの比較結果
- システム統合・移行計画書
```

---

## 🎯 **Phase D1: データ整合性チェック**

### **実行プロンプト D1**

```
【参照必須ドキュメント】
- /mnt/c/instagram-course/instagram-post-generator/docs/KNOWLEDGE_BASE_SYSTEM_ANALYSIS_MEMO.md
- Phase B1-B3の全出力結果（ペルソナクリーンアップ・ターゲット再分類・構造分析）
- Phase C1-C5の全出力結果（システム実装）

【タスク概要】
実装完了したシステムの投稿タイプフィルタリング用データの整合性・品質を最終検証する。

【チェック項目】
1. ペルソナ-ナレッジ-投稿タイプの3者関係整合性
   - 全ての関係が論理的に一致しているか
   - 矛盾・不整合がないか
   - フィルタリング動作の正確性

2. ターゲット内ペルソナ重複の完全排除確認
   - Phase B1での重複削除が完全か
   - 新たな重複の発生がないか
   - データ品質の維持状況

3. ナレッジ構造データの完整性
   - 全116ナレッジの構造データ整備状況
   - 欠損・不完全データの検出
   - 構造保持機能の動作確認

4. システム全体の動作整合性
   - エンドツーエンドでの動作確認
   - 各フィルタリング段階での整合性
   - エラー・例外ケースの処理確認

【具体的実行内容】
1. 自動整合性チェックツールの作成・実行
2. 全データの網羅的検証
3. システム動作テスト・結果検証
4. 品質レポートの作成・問題点の特定
5. 発見問題の修正・再検証

【出力要求】
- データ整合性チェックレポート
- 品質保証証明書
- 発見問題と修正内容の記録
- システム動作確認結果
```

---

## 🎯 **Phase D2: テスト環境構築と品質検証フレームワーク**

### **実行プロンプト D2**

```
【参照必須ドキュメント】
- /mnt/c/instagram-course/instagram-post-generator/docs/KNOWLEDGE_BASE_SYSTEM_ANALYSIS_MEMO.md
- 全Phase A-D1の出力結果

【タスク概要】
新フローの継続的品質保証のためのテスト環境・検証フレームワークを構築する。

【構築要件】
1. 各段階でのテストケース
   - 投稿タイプ選択→ターゲット選択のテスト
   - フィルタリング機能のテスト
   - AI類似度検索のテスト
   - ナレッジ構造保持のテスト

2. エンドツーエンドテスト環境
   - 実際のユーザーフロー再現
   - 多様な入力パターンでのテスト
   - パフォーマンス・負荷テスト

3. 品質評価指標・基準
   - ナレッジ構造保持率の測定
   - 類似度検索精度の評価
   - ユーザー体験品質の測定
   - システム応答性能の評価

4. 継続的監視・改善システム
   - 自動テスト・監視機能
   - 品質劣化の早期検出
   - 改善提案の自動生成

【具体的実行内容】
1. テストケース設計・実装
2. テスト環境セットアップ
3. 品質評価指標の定義・測定実装
4. 継続的監視システムの構築
5. テスト実行・結果分析・改善提案

【出力要求】
- 完全なテスト環境
- 品質評価基準・測定ツール
- テスト実行結果・品質レポート
- 継続的改善のためのモニタリングシステム
- 運用・保守マニュアル
```

---

## 📋 **実行の流れ**

### **段階的コピペ実行手順**
1. **Phase A1** → データ分析実行 → 結果確認
2. **Phase A2** → ギャップ分析実行 → 結果確認  
3. **Phase B1** → ペルソナクリーンアップ実行 → 結果確認
4. **Phase B2** → ターゲット再分類実行 → 結果確認
5. **Phase B3** → ナレッジ構造分析実行 → 結果確認
6. **Phase C1** → UI改修実行 → 結果確認
7. **Phase C2** → AI類似度検索実装 → 結果確認
8. **Phase C3** → プロンプト改善実装 → 結果確認
9. **Phase C4** → フロー統合実装 → 結果確認
10. **Phase C5** → 動的構成システム実装 → 結果確認
11. **Phase D1** → 品質検証実行 → 結果確認
12. **Phase D2** → テスト環境構築 → 完了

### **各フェーズ成功基準**
- Phase A: データ分析レポート完成・ギャップ特定完了
- Phase B: ペルソナクリーンアップ・再分類・構造分析完了
- Phase C: 全システム実装完了・動作確認済み
- Phase D: 品質検証完了・継続運用体制確立

---

**最終更新**: 2025-07-22  
**文書種別**: 完全実行計画書  
**対象**: 段階的コピペ実行専用