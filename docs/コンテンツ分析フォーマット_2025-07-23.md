# コンテンツ分析フォーマット - ナレッジ詳細記録

## 📅 作成日時
2025年7月23日

## 🎯 分析目的

投稿画像から**具体的なコンテンツ内容**を抽出し、ナレッジデータベースに詳細情報として記録する。従来の概要的なナレッジから、実際のコンテンツ内容に基づいた詳細ナレッジへ転換。

## 📋 分析手順

### 1. コンテンツ詳細分析
- 投稿の全ページを詳細に分析
- 各ページの内容を具体的に記録
- レイアウト・表現方法を詳細記録

### 2. ペルソナ分析
以下を特定：
- **悩み・困った**: ユーザーが抱える具体的な問題・困難な状況
- **ニーズ（情報）**: 欲しい情報・知りたいこと
- **目的**: 達成したいゴール（手順実行による達成）
- **有益情報**: 知ったら明日から役立つ・活かせる情報

### 3. 投稿タイプ分類ルール
課題の性質により投稿タイプを自動判定：

| 課題タイプ | 投稿タイプ | 説明 |
|-----------|-----------|------|
| **悩み・困った** | **001** | 感情的な問題・困難な状況の解決 |
| **目的** | **002** | 明確な手順で達成可能なゴール |
| **ニーズ（情報）** | **003** | 特定の情報・知識の習得 |
| **有益情報** | **004** | 知ったら明日から役立つ実用情報 |

**判定基準:**
- **002（目的）**: 順番に実行すると目的が「達成」できる詳細手順
- **004（有益情報）**: 知ったら具体的アクションプランに繋がる情報

**例:**
- `ChatGPTの使い方` → 手順による達成 → **002**
- `便利なAI活用術5選` → 知ったら役立つ情報 → **004**

### 4. 解決方法分析
ペルソナの課題に対して、投稿がどのように解決しているかを分析

## 🔧 新ナレッジフォーマット（AI最適化構造）

**個別ナレッジファイル形式（Kxxx.json）:**

```json
{
  "source": "contents-xxx",
  "problemCategory": "問題のカテゴリ",
  "problemDescription": "ペルソナの「悩み・困った」「ニーズ（情報）」「目的」「有益情報」のいずれか",
  "postType": "001-004のいずれか（課題タイプにより自動判定）",
  "postTypeReason": "投稿タイプ判定の理由",
  "solutionContent": {
    "概要": "どのように解決したか",
    "具体的手順": [],
    "提供情報": [],
    "実用的なアドバイス": []
  },
  "effectiveExpressions": [
    "各ページのレイアウト・表現方法（視覚的要素含む）",
    "情報の整理方法",
    "デザイン的特徴（AIが直接使用しない参考情報）"
  ],
  "searchKeywords": [
    "ナレッジ類似判定AI用キーワード",
    "コンテンツ関連キーワード"
  ],
  "emotionalTriggers": [
    "投稿がユーザーに望むアクション",
    "問題解決への導き方",
    "共感・安心・スキル獲得・情報活用等"
  ],
  "marketingStage": "ターゲットユーザーの具体的レベル・学習段階・社会人経験等",
  "knowledgeId": "Kxxx",
  "pageStructurePattern": "mock-method-xpage",
  "actualTitle": "投稿トップページのタイトル",
  "pageCount": ページ数,
  "hashTag": "投稿に付けられたハッシュタグ（メタデータとして記録）",
  "detailedContent": {
    "page1": {
      "title": "ページタイトル",
      "pageType": "coverPage|problemIdentification|toolIntroduction|summary|engagement",
      "authorCredentials": {
        "age": "年齢",
        "experience": "経験年数",
        "credibilityFactor": "信頼性要因"
      },
      "mainTopic": "メインテーマ"
    },
    "page2": {
      "title": "ページタイトル",
      "pageType": "problemIdentification",
      "targetAudience": "ターゲット層",
      "items": ["課題1", "課題2", "課題3"],
      "authorEmpathy": "共感メッセージ",
      "solutionPromise": "解決約束",
      "authorCredibility": "投稿者の信頼性"
    },
    "pageX": {
      "title": "ページタイトル",
      "pageType": "toolIntroduction", 
      "category": "ツールカテゴリ",
      "items": [
        {
          "itemName": "アイテム名",
          "content": "実際の説明文をそのまま記録"
        }
      ]
    }
    // 全ページ分記録（純粋なコンテンツ情報のみ）
  }
}
```

## 📝 記録項目詳細

### 必須フィールド
1. **source**: `contents-xxx` 形式の一意識別子
2. **problemCategory**: 問題の分類
3. **problemDescription**: ペルソナの具体的課題
4. **postType**: 投稿タイプ（001-004）の自動判定
5. **postTypeReason**: 投稿タイプ判定の根拠
6. **solutionContent**: 解決方法の詳細
7. **knowledgeId**: `Kxxx` 形式（sourceと一致）

### 投稿タイプ判定ロジック
分析時に以下を判定：
1. **課題の性質**: 悩み・困った / ニーズ（情報）/ 目的 / 有益情報
2. **コンテンツの構造**: 手順型 vs 情報提供型
3. **期待される結果**: 達成 vs 活用

**判定例:**
- 手順1→2→3で目標達成 = **002（目的）**
- 知識・情報の羅列で活用促進 = **004（有益情報）**

### 分析項目
1. **effectiveExpressions**: レイアウト・表現の詳細（視覚的要素含む・参考用）
2. **searchKeywords**: AI判定用キーワード
3. **emotionalTriggers**: ユーザーへの期待アクション
4. **marketingStage**: ターゲットの学習レベル

### コンテンツ詳細
1. **actualTitle**: 実際のタイトル
2. **pageCount**: ページ数
3. **hashTag**: 使用ハッシュタグ（メタデータ）
4. **detailedContent**: 全ページの詳細内容（AI使用対象）

### 構造情報
1. **pageStructurePattern**: ページ構成パターン（暫定: `mock-method-xpage`）

## 🔑 AI最適化設計ルール

### **1. 画像忠実性の原則（最重要）**
- **視覚的構造の尊重**: 画像で改行されている箇所、アイテムが分かれている箇所を正確に反映
- **アイテム分離の基準**: 画像でアイテムが分かれている場合は必ず配列・オブジェクトで分離
- **文脈保持**: 画像で連続している文章は分割せず、そのまま記録
- **改行・段落**: 画像の改行位置、段落分けを構造に反映

**例:**
- 画像で「ツールA」「ツールB」が別々のカードで表示 → 別々のarray要素
- 画像で「400万人が想いで仕事探し」が一文 → 分割せずに一つの`content`
- 画像でチェックボックス形式のリスト → `items`配列で構造化

### **2. コンテンツ vs 視覚的要素の分離**
- **`detailedContent`**: AIが直接使用する純粋なコンテンツ情報のみ
- **`effectiveExpressions`**: 視覚的要素・デザイン情報（参考用・AI使用対象外）
- **禁止事項**: 「アイコン」「カラフル」等の視覚的表現をコンテンツに混入させない

### **3. 構造化の原則**
- **画像基準**: 画像の視覚的構造を最優先にして構造化を決定
- **過度な分割禁止**: 画像で一つの文章・段落になっているものを不自然に分割しない
- **不足分離禁止**: 画像で明確に分かれているものを一つにまとめない
- **統一フォーマット**: 同種の情報は同じ構造で記録（ただし画像構造を優先）

### **4. AIの使用パターンに対応**
- **要素抽出**: `itemName`, `content`, `items`等を直接参照可能
- **部分利用**: 用途に応じた部分的な情報取得が可能
- **文脈理解**: 画像に忠実な文脈を保持してAIの理解をサポート
- **一貫性**: 画像構造に基づいた一貫した記録方法

### **5. ハッシュタグ・メタデータの扱い**
- **投稿コンテンツ**: 実際の投稿ページのみを`detailedContent`に記録
- **メタデータ画面**: 投稿後の詳細表示・ハッシュタグページは除外
- **ハッシュタグ**: `hashTag`フィールドに記録（コンテンツ生成には使用しない）
- **判定基準**: 最後のページがプロフィール・ハッシュタグ情報の場合は投稿コンテンツから除外

## 🎯 分析の重要ポイント

### コンテンツ = ナレッジ
- 概要的な記述から具体的なコンテンツ内容へ
- 実際の投稿内容を忠実に記録
- ページごとの詳細を漏れなく収録

### ペルソナ課題の特定
- 表面的でない深い課題を特定
- 具体的なシチュエーション・悩みを記録
- ターゲットの学習レベル・経験値を正確に判定

### 解決方法の詳細化
- 単なる情報提供でなく、どう解決するかの具体的手順
- ユーザーの行動変容を促すアプローチ
- 実用性・実行可能性の観点

### AI理解優先設計
- **AIの理解しやすさ**: 構造化された情報配置
- **AIの使用方法**: コンテンツ生成時の参照パターンを考慮
- **情報の純度**: 視覚的要素を排除した純粋なコンテンツ情報
- **構造の一貫性**: 同種の情報は統一フォーマットで記録

## 📋 実装例（contents-102）

### ページタイプ別構造例

**カバーページ（page1）:**
```json
{
  "pageType": "coverPage",
  "authorCredentials": {"age": "37歳", "experience": "フリーランス6年目"},
  "mainTopic": "フリーランス必須ツール10選"
}
```

**問題提起ページ（page2）:**
```json
{
  "pageType": "problemIdentification",
  "problems": ["課題1", "課題2", "課題3"],
  "authorEmpathy": "共感メッセージ",
  "solutionPromise": "解決約束"
}
```

**ツール紹介ページ（page3-7）:**
```json
{
  "pageType": "toolIntroduction",
  "category": "お仕事ツール",
  "items": [{
    "itemName": "アイテム名",
    "content": "実際の説明文をそのまま記録"
  }]
}
```

## 📂 出力ファイル

### 分析結果の保存先

**新フォーマット対応（2025年7月23日以降）:**
- **保存先**: `/app/data/knowledgeBase/knowledge/`
- **ファイル名**: `Kxxx.json` (例: `K001.json`, `K102.json`)
- **用途**: システムが直接参照するナレッジデータ

**従来の分析記録（参考用）:**
- **保存先**: `/docs/コンテンツ分析結果/`
- **ファイル名**: `contents-xxx_analysis_YYYY-MM-DD.json`
- **用途**: 分析過程の記録・参考資料

### 🔄 新システム移行方針

1. **既存分析の再分析**: 新フォーマットに従ってコンテンツを再分析
2. **Kxxx.json形式**: ナレッジID（K001-K116+）でファイル命名
3. **システム統合**: `/app/data/knowledgeBase/knowledge/`から直接読み込み
4. **品質向上**: 画像忠実性の原則に基づく高精度分析

### 📋 ファイル管理ルール

- **ファイル名**: `Kxxx.json` (xxxはコンテンツID)
- **命名例**: 
  - `contents-001` → `K001.json`
  - `contents-102` → `K102.json`
  - `contents-117` → `K117.json`
- **一意性**: 各ナレッジIDは唯一のコンテンツに対応
- **拡張性**: 新しいコンテンツ分析時はコンテンツIDに対応する番号を使用
- **整合性**: `problemSolutionPairs.json`のknowledgeIdフィールドと一致

### 🔗 分析完了後のシステム連携

**1️⃣ ナレッジファイル保存**
- `/app/data/knowledgeBase/knowledge/Kxxx.json` に分析結果を保存

**2️⃣ マスターデータ更新**
- **ファイル**: `/app/data/knowledgeBase/type-target-persona-relations.json`
- **更新項目**: `targetToPersonas` と `personaToKnowledge`

**3️⃣ ペルソナID・ナレッジID設定**
- **ペルソナID**: `Pxxx` (xxxはコンテンツID)
- **ナレッジID**: `Kxxx` (xxxはコンテンツID)
- **例**: contents-102 → P102, K102

**4️⃣ ターゲット振り分け基準（投稿タイプ別）**

| 投稿タイプ | ターゲットID | ターゲット名 |
|-----------|-------------|-------------|
| **001** | T001 | 就活に不安を感じている学生 |
| **001** | T002 | 仕事のストレスで悩んでいる人 |
| **001** | T003 | 転職すべきか迷っている人 |
| **002** | T004 | 就活で差をつけたい学生 |
| **002** | T005 | 新しいスキルを身につけたい人 |
| **002** | T006 | キャリアアップしたい人 |
| **003** | T007 | 業界研究をしている就活生 |
| **003** | T008 | 転職先を探している人 |
| **003** | T009 | 企業選択で迷っている人 |
| **004** | T010 | AIを仕事に活かしたい人 |
| **004** | T011 | 生産性を上げたい人 |
| **004** | T012 | 時短で結果を出したい就活生 |

**5️⃣ 更新例（contents-102の場合）**

**ナレッジファイル作成:**
- `/app/data/knowledgeBase/knowledge/K102.json` に新フォーマットで保存

**マスターデータ更新:**
```json
{
  "targetToPersonas": {
    "T010": ["P102"]  // 投稿タイプ004のターゲットに追加
  },
  "personaToKnowledge": {
    "P102": "K102"    // ペルソナ→ナレッジの紐づけ
  }
}
```

**重要な変更点:**
- ❌ 旧式: `pairs`オブジェクト内にコンテンツキーで格納
- ✅ 新式: 個別ファイルに直接的な構造で格納
- ❌ 旧式: `problems` フィールド
- ✅ 新式: `items` フィールド（汎用的）
- ❌ 旧式: `toolName` フィールド
- ✅ 新式: `itemName` + `content` フィールド（画像に忠実）

このフォーマットにより、AIが高精度でナレッジマッチングを行い、ユーザーの具体的ニーズに対応した最適なコンテンツ生成が可能となる。