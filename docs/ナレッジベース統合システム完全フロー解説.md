# ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹çµ±åˆã‚·ã‚¹ãƒ†ãƒ å®Œå…¨ãƒ•ãƒ­ãƒ¼è§£èª¬

## ğŸ“š æ¦‚è¦
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã‚’é¸æŠã—ã¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆã‚’å®Ÿè¡Œã—ãŸå ´åˆã®ã€handleContentSubmitå®Ÿè¡Œå¾Œã®å®Œå…¨ãªãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã‚’è§£èª¬ã—ã¾ã™ã€‚

---

## ğŸ¬ é–‹å§‹æ™‚ç‚¹ã®çŠ¶æ³
```javascript
// ContentInputã‹ã‚‰è¦ªã«æ¸¡ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿
content = "ã€ã‚¸ãƒ£ãƒ³ãƒ«ã€‘: knowhow [ã‚¬ã‚¯ãƒã‚«ä½œæˆæ³•]:é•·æœŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³æœªçµŒé¨“ã§ã‚‚å†…å®šã‚’æ´ã‚€ï¼4ã‚¹ãƒ†ãƒƒãƒ—ã§..."

knowledgeBaseParams = {
  typeId: "001",
  targetId: "T001", 
  personaIds: ["P001", "P004"],
  knowledgeIds: ["K004"], // AIåˆ¤å®šã§K001ã‚’é™¤å¤–ã€K004ã®ã¿æ®‹ã£ãŸ
  knowledgeContents: [
    {
      knowledgeId: "K004",
      actualTitle: "è‡ªåˆ†ã‚’è¦‹ç›´ã—ã¦ã¿ã‚ˆã†ï¼è‡ªå·±åˆ†æã®æ–¹æ³•5é¸",
      problemDescription: "è‡ªå·±åˆ†æã®æ–¹æ³•ãŒã‚ã‹ã‚‰ãªã„ã€ä½•ã‹ã‚‰å§‹ã‚ã‚Œã°ã„ã„ã‹è¿·ã£ã¦ã„ã‚‹å°±æ´»ç”Ÿã®æ‚©ã¿",
      solutionContent: {
        methods: [...], // è‡ªå·±åˆ†æã®å…·ä½“çš„æ‰‹æ³•ãƒ‡ãƒ¼ã‚¿
        keyMessage: "è‡ªå·±åˆ†æã¯ç¹°ã‚Šè¿”ã—ã‚„ã‚‹ã“ã¨ãŒå¤§äº‹ï¼"
      },
      searchKeywords: ["è‡ªå·±åˆ†æ", "æ–¹æ³•", "å°±æ´»", "è‡ªåˆ†å²", "ãªãœã®æ·±æ˜ã‚Š"...],
      effectiveExpressions: ["è‡ªåˆ†ã‚’è¦‹ç›´ã—ã¦ã¿ã‚ˆã†ï¼", "ãã‚‚ãã‚‚ãªãœè‡ªå·±åˆ†æãŒå¿…è¦ï¼Ÿ"...],
      emotionalTriggers: ["è¡Œå‹•ä¿ƒé€²", "å­¦ç¿’æ„æ¬²", "ç¶™ç¶šé‡è¦–"]
    }
  ],
  useKnowledgeBase: true
}
```

---

## ğŸš€ ã‚¹ãƒ†ãƒƒãƒ—1: è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®å—ã‘å–ã‚Š

**å ´æ‰€:** `NewFlowPostGenerator.tsx` - `handleContentSubmit()`

**ä½•ã‚’ã™ã‚‹:** ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã¨ãƒŠãƒ¬ãƒƒã‚¸é¸æŠçµæœã‚’å—ã‘å–ã£ã¦ã€ç”»é¢çŠ¶æ…‹ã‚’æ›´æ–°ã—ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆã‚µãƒ¼ãƒ“ã‚¹ã‚’å‘¼ã³å‡ºã™

**å‡¦ç†å†…å®¹:**
```javascript
const handleContentSubmit = async (content, knowledgeBaseParams) => {
  // ç”»é¢çŠ¶æ…‹ã®æ›´æ–°
  setInputContent(content) // å…¥åŠ›å†…å®¹ã‚’ä¿å­˜
  setCurrentStep('generation') // ã€Œç”Ÿæˆä¸­ã€ç”»é¢ã«åˆ‡ã‚Šæ›¿ãˆ
  setIsGenerating(true) // ç”Ÿæˆãƒ•ãƒ©ã‚°ã‚’ON
  setGenerationStatus('AIãŒé«˜å“è³ªãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆä¸­...')
  
  // ãƒ¡ã‚¤ãƒ³ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆã‚µãƒ¼ãƒ“ã‚¹å‘¼ã³å‡ºã—
  const generated = await contentGeneratorService.generateHighQualityContent(
    content, // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŠ•ç¨¿å†…å®¹ï¼ˆé•·æ–‡ï¼‰
    knowledgeBaseParams // é¸æŠã•ã‚ŒãŸãƒŠãƒ¬ãƒƒã‚¸æƒ…å ±
  )
}
```

---

## ğŸ“‹ ã‚¹ãƒ†ãƒƒãƒ—2: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆã‚µãƒ¼ãƒ“ã‚¹é–‹å§‹

**å ´æ‰€:** `contentGeneratorService.ts` - `generateHighQualityContent()`

**ä½•ã‚’ã™ã‚‹:** 2æ®µéšãƒ•ãƒ­ãƒ¼ã§ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆã™ã‚‹ã€‚1æ®µéšç›®ã§ãƒšãƒ¼ã‚¸æ§‹é€ ã‚’æ±ºå®šã—ã€2æ®µéšç›®ã§ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆã™ã‚‹

**å‡¦ç†å†…å®¹:**
```javascript
async generateHighQualityContent(userInput, knowledgeBaseParams) {
  // åŒæ™‚å®Ÿè¡Œé˜²æ­¢ï¼ˆ503ã‚¨ãƒ©ãƒ¼å¯¾ç­–ï¼‰
  if (this.isGenerating) {
    throw new Error('AIç”ŸæˆãŒé€²è¡Œä¸­ã§ã™ã€‚å°‘ã—å¾…ã£ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚')
  }
  this.isGenerating = true
  
  console.log('ğŸš€ 2æ®µéšãƒ•ãƒ­ãƒ¼é–‹å§‹...')
  
  // â˜…1æ®µéšç›®: ãƒšãƒ¼ã‚¸æ§‹é€ æ±ºå®š
  console.log('ğŸ“‹ æ®µéš1: ãƒšãƒ¼ã‚¸æ§‹é€ åˆ†æä¸­...')
  const pageStructures = await pageStructureAnalyzer.analyzePageStructureAndTemplates(
    userInput, // "ã€ã‚¸ãƒ£ãƒ³ãƒ«ã€‘: knowhow [ã‚¬ã‚¯ãƒã‚«ä½œæˆæ³•]..."
    knowledgeBaseParams // é¸æŠæ¸ˆã¿ãƒŠãƒ¬ãƒƒã‚¸æƒ…å ±
  )
}
```

**å¼•æ•°ã®è©³ç´°:**
- `userInput`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã—ãŸæŠ•ç¨¿å†…å®¹ã®å…¨æ–‡
- `knowledgeBaseParams`: AIåˆ¤å®šã§çµã‚Šè¾¼ã¾ã‚ŒãŸK004ã®ãƒŠãƒ¬ãƒƒã‚¸ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€å®Œå…¨ãªæƒ…å ±

---

## ğŸ” ã‚¹ãƒ†ãƒƒãƒ—3: ãƒšãƒ¼ã‚¸æ§‹é€ åˆ†æã®é–‹å§‹

**å ´æ‰€:** `pageStructureAnalyzer.ts` - `analyzePageStructureAndTemplates()`

**ä½•ã‚’ã™ã‚‹:** å…¥åŠ›ã‹ã‚‰ã‚¸ãƒ£ãƒ³ãƒ«ã‚’åˆ¤å®šã—ã€ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ä½¿ç”¨ã®å ´åˆã¯å°‚ç”¨ã®çµ±åˆã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè¡Œã™ã‚‹

**å‡¦ç†å†…å®¹:**
```javascript
async analyzePageStructureAndTemplates(input, knowledgeBaseParams) {
  // ã‚¸ãƒ£ãƒ³ãƒ«æƒ…å ±ã®æŠ½å‡ºãƒ»åˆ¤å®š
  const specifiedGenre = this.extractGenreFromInput(input) // "knowhow"ã‚’æŠ½å‡º
  const detectedGenre = specifiedGenre || this.genreDetector.detectGenre(input)
  
  console.log(`ğŸ¯ ã‚¸ãƒ£ãƒ³ãƒ«åˆ¤å®šçµæœ: ${detectedGenre}`) // "knowhow"
  
  // â˜…é‡è¦ãªåˆ†å²ç‚¹: ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹çµ±åˆã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨ã™ã‚‹ã‹ï¼Ÿ
  if (knowledgeBaseParams?.useKnowledgeBase && 
      knowledgeBaseParams.typeId && 
      knowledgeBaseParams.targetId) {
    
    console.log('ğŸš€ ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹çµ±åˆã‚·ã‚¹ãƒ†ãƒ å®Ÿè¡Œ')
    return this.generateStructuredContent(input, knowledgeBaseParams)
  } else {
    // å¾“æ¥ã®AIåˆ†æãƒ«ãƒ¼ãƒˆï¼ˆä»Šå›ã¯å®Ÿè¡Œã•ã‚Œãªã„ï¼‰
    return this.å¾“æ¥ã®AIåˆ†æ()
  }
}
```

**åˆ¤å®šçµæœ:**
- `specifiedGenre = "knowhow"` (å…¥åŠ›ã‹ã‚‰æŠ½å‡º)
- `useKnowledgeBase = true` ãªã®ã§çµ±åˆã‚·ã‚¹ãƒ†ãƒ ãƒ«ãƒ¼ãƒˆã«é€²ã‚€

---

## ğŸ¯ ã‚¹ãƒ†ãƒƒãƒ—4: ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹çµ±åˆã‚·ã‚¹ãƒ†ãƒ å®Ÿè¡Œ

**å ´æ‰€:** `pageStructureAnalyzer.ts` - `generateStructuredContent()`

**ä½•ã‚’ã™ã‚‹:** TypeIDã¨TargetIDã‚’ä½¿ã£ã¦å³å¯†ã«ãƒãƒƒãƒã™ã‚‹ãƒšãƒ¼ã‚¸æ§‹é€ ã‚’å–å¾—ã—ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ã‚’å®Ÿè¡Œã™ã‚‹

**å‡¦ç†å†…å®¹:**
```javascript
private async generateStructuredContent(input, params) {
  console.log('ğŸ¯ æ–°çµ±åˆã‚·ã‚¹ãƒ†ãƒ é–‹å§‹:', {
    typeId: params.typeId,    // "001"
    targetId: params.targetId // "T001"
  })
  
  // â˜…ã‚µãƒ–ã‚¹ãƒ†ãƒƒãƒ—4-1: ãƒšãƒ¼ã‚¸æ§‹é€ ã®å³å¯†ãƒãƒƒãƒãƒ³ã‚°
  const { pattern, structure } = PageStructureMatcher.getCompletePageStructure(
    params.typeId,   // "001" (å°±æ´»ãƒã‚¦ãƒ„ãƒ¼ç³»)
    params.targetId  // "T001" (æ–°å’å‘ã‘)
  )
  
  console.log('âœ… ãƒšãƒ¼ã‚¸æ§‹é€ ãƒãƒƒãƒãƒ³ã‚°æˆåŠŸ:', pattern.description)
  // â†’ "å°±æ´»ãƒã‚¦ãƒ„ãƒ¼Ã—æ–°å’å‘ã‘ 5ãƒšãƒ¼ã‚¸æ§‹æˆ"ã®ã‚ˆã†ãªæ§‹é€ ãŒæ±ºå®š
  
  // â˜…ã‚µãƒ–ã‚¹ãƒ†ãƒƒãƒ—4-2: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé …ç›®ãƒãƒƒãƒ”ãƒ³ã‚°
  const mapper = new TemplateItemMapper()
  const mappingResult = await mapper.mapContentToPages(
    input,     // ãƒ¦ãƒ¼ã‚¶ãƒ¼æŠ•ç¨¿å†…å®¹
    structure  // æ±ºå®šã•ã‚ŒãŸãƒšãƒ¼ã‚¸æ§‹é€ å®šç¾©
  )
}
```

**å¼•æ•°ã®è©³ç´°:**
- `params.typeId = "001"`: æŠ•ç¨¿ã‚¿ã‚¤ãƒ—ï¼ˆå°±æ´»ãƒã‚¦ãƒ„ãƒ¼ç³»ï¼‰
- `params.targetId = "T001"`: ã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼ˆæ–°å’å‘ã‘ï¼‰
- `structure`: ãƒãƒƒãƒã—ãŸãƒšãƒ¼ã‚¸æ§‹é€ ã®è©³ç´°å®šç¾©ï¼ˆä½•ãƒšãƒ¼ã‚¸ç›®ã«ã©ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ã†ã‹ãªã©ï¼‰

---

## ğŸ“Š ã‚¹ãƒ†ãƒƒãƒ—5: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé …ç›®ãƒãƒƒãƒ”ãƒ³ã‚°

**å ´æ‰€:** `TemplateItemMapper.ts` - `mapContentToPages()`

**ä½•ã‚’ã™ã‚‹:** æ±ºå®šã•ã‚ŒãŸãƒšãƒ¼ã‚¸æ§‹é€ ã«åŸºã¥ã„ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‹ã‚‰å„ãƒšãƒ¼ã‚¸ã®å…·ä½“çš„ãªé …ç›®ã‚’æŠ½å‡ºã™ã‚‹

**å‡¦ç†å†…å®¹:**
```javascript
async mapContentToPages(input, pageStructure) {
  console.log(`ğŸ¯ Starting template item mapping for: ${pageStructure.name}`)
  console.log(`ğŸ“„ Processing ${pageStructure.pages.length} pages`)
  
  const mappedPages = []
  
  // å„ãƒšãƒ¼ã‚¸ã‚’é †ç•ªã«å‡¦ç†
  for (const page of pageStructure.pages) {
    // â˜…å„ãƒšãƒ¼ã‚¸ã”ã¨ã®ãƒãƒƒãƒ”ãƒ³ã‚°å®Ÿè¡Œ
    const mappedContent = await this.mapSinglePage(
      input,                           // ãƒ¦ãƒ¼ã‚¶ãƒ¼æŠ•ç¨¿å†…å®¹
      page,                           // ç¾åœ¨å‡¦ç†ä¸­ã®ãƒšãƒ¼ã‚¸å®šç¾©
      pageStructure.targetCombination // "001-T001"ã®ã‚ˆã†ãªçµ„ã¿åˆã‚ã›
    )
    
    mappedPages.push(mappedContent)
    console.log(`âœ… Page ${page.pageNumber} mapped successfully`)
  }
}
```

**pageStructure ã®ä¾‹:**
```javascript
{
  name: "å°±æ´»ãƒã‚¦ãƒ„ãƒ¼Ã—æ–°å’å‘ã‘ 5ãƒšãƒ¼ã‚¸æ§‹æˆ",
  pages: [
    {
      pageNumber: 1,
      templateId: "basic-title",
      title: "ã‚¿ã‚¤ãƒˆãƒ«ãƒšãƒ¼ã‚¸",
      role: "introduction"
    },
    {
      pageNumber: 2, 
      templateId: "simple-items",
      title: "è‡ªå·±åˆ†æã®æ–¹æ³•",
      role: "method-explanation"
    },
    // ... 3ã€œ5ãƒšãƒ¼ã‚¸
  ]
}
```

---

## ğŸ” ã‚¹ãƒ†ãƒƒãƒ—6: å˜ä¸€ãƒšãƒ¼ã‚¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°å‡¦ç†

**å ´æ‰€:** `TemplateItemMapper.ts` - `mapSinglePage()`

**ä½•ã‚’ã™ã‚‹:** 1ãƒšãƒ¼ã‚¸åˆ†ã®å…·ä½“çš„ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã€ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æŠ½å‡ºã¾ãŸã¯AIç”Ÿæˆã§ä½œæˆã™ã‚‹

**å‡¦ç†å†…å®¹:**
```javascript
private async mapSinglePage(input, page, targetCombination) {
  console.log(`ğŸ” Mapping page ${page.pageNumber}: ${page.role}`)
  
  try {
    // â˜…ç¾åœ¨ã®å•é¡Œç®‡æ‰€: ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ã®æŠ½å‡º
    const mappedItems = await this.extractFromKnowledgeBase(
      input,             // ãƒ¦ãƒ¼ã‚¶ãƒ¼æŠ•ç¨¿å†…å®¹
      page,             // ãƒšãƒ¼ã‚¸å®šç¾©ï¼ˆtemplateId, roleãªã©ï¼‰
      targetCombination // "001-T001"
    )
    
    return {
      pageNumber: page.pageNumber,    // 2
      templateId: page.templateId,    // "simple-items" 
      title: page.title,              // "è‡ªå·±åˆ†æã®æ–¹æ³•"
      mappedItems: mappedItems        // æŠ½å‡ºã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„
    }
  } catch (error) {
    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: AIç”Ÿæˆ
    console.warn('âš ï¸ Knowledge base extraction failed, falling back to AI generation')
    const aiGeneratedItems = await this.generateWithAI(input, page)
    return { /* AIç”Ÿæˆçµæœ */ }
  }
}
```

---

## âŒ ã‚¹ãƒ†ãƒƒãƒ—7: ç¾åœ¨ã®å•é¡Œç®‡æ‰€ - ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹æŠ½å‡º

**å ´æ‰€:** `TemplateItemMapper.ts` - `extractFromKnowledgeBase()`

**ç¾åœ¨ã®å•é¡Œ:** æ—¢ã«é¸æŠæ¸ˆã¿ã®K004ãƒŠãƒ¬ãƒƒã‚¸ãƒ‡ãƒ¼ã‚¿ã‚’ç„¡è¦–ã—ã¦ã€å†åº¦æ¨å®šãƒ»æ¤œç´¢ã—ã¦ã„ã‚‹

**ç¾åœ¨ã®å‡¦ç†å†…å®¹:**
```javascript
private async extractFromKnowledgeBase(input, page, targetCombination) {
  // âŒ å•é¡Œ1: å…¥åŠ›ã‹ã‚‰å†æ¨å®šï¼ˆæ—¢ã«é¸æŠæ¸ˆã¿ãªã®ã«ï¼‰
  const personaId = this.extractPersonaFromInput(input)           // æ¨å®šã§P002?
  const category = this.extractCategoryFromPageRole(page.role)    // "self-analysis"
  const emotionalTrigger = this.extractEmotionalTriggerFromInput(input) // "motivation"
  
  // âŒ å•é¡Œ2: å†æ¤œç´¢ï¼ˆé¸æŠæ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã®ã«ï¼‰
  const searchResults = this.knowledgeSearch.searchPinpoint(
    personaId,       // æ¨å®šå€¤
    category,        // æ¨å®šå€¤  
    emotionalTrigger // æ¨å®šå€¤
  )
  
  // æ¤œç´¢çµæœã‹ã‚‰æœ€é©ãªã‚‚ã®ã‚’é¸æŠ
  const bestMatch = searchResults[0]
  return this.formatDataForTemplate(bestMatch, page)
}
```

**æœ¬æ¥ã‚ã‚‹ã¹ãå‡¦ç†:**
```javascript
// âœ… æ­£ã—ã„å‡¦ç†ï¼ˆå®Ÿè£…ã™ã¹ãï¼‰
private async extractFromKnowledgeBase(input, page, targetCombination, knowledgeContents) {
  // é¸æŠæ¸ˆã¿ã®ãƒŠãƒ¬ãƒƒã‚¸ãƒ‡ãƒ¼ã‚¿ï¼ˆK004ï¼‰ã‚’ç›´æ¥ä½¿ç”¨
  const selectedKnowledge = knowledgeContents[0] // K004ã®ãƒ‡ãƒ¼ã‚¿
  
  console.log(`âœ… Using pre-selected knowledge: ${selectedKnowledge.knowledgeId}`)
  
  // K004ã®å†…å®¹ã‚’ç›´æ¥ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå½¢å¼ã«å¤‰æ›
  return this.formatSelectedKnowledgeForTemplate(selectedKnowledge, page)
}
```

---

## ğŸ”„ ã‚¹ãƒ†ãƒƒãƒ—8: çµæœã®å¤‰æ›ã¨è¿”å´

**å ´æ‰€:** `pageStructureAnalyzer.ts` ã«æˆ»ã‚‹

**ä½•ã‚’ã™ã‚‹:** ãƒãƒƒãƒ”ãƒ³ã‚°çµæœã‚’PageStructureå½¢å¼ã«å¤‰æ›ã—ã¦è¿”å´

**å‡¦ç†å†…å®¹:**
```javascript
// ãƒãƒƒãƒ”ãƒ³ã‚°å®Œäº†å¾Œ
const pageStructures = mappingResult.pages.map(page => ({
  æ¦‚è¦: `ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹çµ±åˆã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚‹æœ€é©åŒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„`,
  æœ‰ç›Šæ€§: `TypeIDÃ—TargetIDå³å¯†ãƒãƒƒãƒãƒ³ã‚°ã«ã‚ˆã‚‹æœ€é©åŒ–ã•ã‚ŒãŸä¾¡å€¤æä¾›`,
  template: page.templateId,    // "simple-items"
  title: page.title,           // "è‡ªå·±åˆ†æã®æ–¹æ³•"
  theme: JSON.stringify(page.mappedItems), // æŠ½å‡ºã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„
  isStructuredGeneration: true // æ–°çµ±åˆã‚·ã‚¹ãƒ†ãƒ è­˜åˆ¥ãƒ•ãƒ©ã‚°
}))

return pageStructures
```

---

## ğŸ‰ ã‚¹ãƒ†ãƒƒãƒ—9: æœ€çµ‚çš„ãªçµæœå‡¦ç†

**å ´æ‰€:** `contentGeneratorService.ts` ã«æˆ»ã‚‹

**ä½•ã‚’ã™ã‚‹:** æ–°çµ±åˆã‚·ã‚¹ãƒ†ãƒ ã®çµæœã‚’å¾“æ¥å½¢å¼ã«å¤‰æ›ã—ã€ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ãƒ»ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’ç”Ÿæˆ

**å‡¦ç†å†…å®¹:**
```javascript
// æ–°çµ±åˆã‚·ã‚¹ãƒ†ãƒ çµæœã®æ¤œå‡º
if (pageStructures.length > 0 && pageStructures[0].isStructuredGeneration) {
  console.log('ğŸš€ æ–°çµ±åˆã‚·ã‚¹ãƒ†ãƒ çµæœæ¤œå‡º - æ®µéš2ã‚’ã‚¹ã‚­ãƒƒãƒ—')
  
  // å¾“æ¥å½¢å¼ã¸ã®å¤‰æ›
  return this.convertStructuredGenerationResult(pageStructures, userInput)
}
```

**convertStructuredGenerationResult()ã®å‡¦ç†:**
```javascript
// PageStructure â†’ GeneratedContent å½¢å¼å¤‰æ›
const pages = pageStructures.map(structure => ({
  pageNumber: index + 1,
  templateType: structure.template,
  content: JSON.parse(structure.theme), // å…·ä½“çš„ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ‡ãƒ¼ã‚¿
  rawContent: structure.æ¦‚è¦
}))

// ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã¨ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ç”Ÿæˆ
const caption = await captionService.generateCaption(userInput, pages)
const hashtags = hashtagService.generateHashtagSets(userInput)

return {
  pages: pages,        // ç”Ÿæˆã•ã‚ŒãŸãƒšãƒ¼ã‚¸é…åˆ—
  totalPages: pages.length,
  caption: caption,    // Instagramç”¨ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³
  hashtags: hashtags   // ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚»ãƒƒãƒˆ
}
```

---

## ğŸ ã‚¹ãƒ†ãƒƒãƒ—10: è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®å®Œäº†å‡¦ç†

**å ´æ‰€:** `NewFlowPostGenerator.tsx` ã«æˆ»ã‚‹

**ä½•ã‚’ã™ã‚‹:** ç”Ÿæˆçµæœã‚’å—ã‘å–ã£ã¦ç”»é¢ã‚’æ›´æ–°ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«çµæœã‚’è¡¨ç¤º

**å‡¦ç†å†…å®¹:**
```javascript
// ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆå®Œäº†
const generated = await contentGeneratorService.generateHighQualityContent(content, knowledgeBaseParams)

console.log('ğŸ¨ é«˜å“è³ªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”ŸæˆæˆåŠŸ - ç”Ÿã®ãƒ‡ãƒ¼ã‚¿')
console.log('ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„:', JSON.stringify(generated, null, 2))

// ç”»é¢çŠ¶æ…‹ã®æ›´æ–°
setGeneratedContent(generated)  // ç”Ÿæˆçµæœã‚’ä¿å­˜
setCurrentStep('approval')      // ã€Œæ‰¿èªã€ç”»é¢ã«ç§»è¡Œ
setIsGenerating(false)          // ç”Ÿæˆãƒ•ãƒ©ã‚°ã‚’OFF
```

**æœ€çµ‚çš„ãªgenerated ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ:**
```javascript
{
  pages: [
    {
      pageNumber: 1,
      templateType: "basic-title",
      content: {
        title: "é•·æœŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³æœªçµŒé¨“ã§ã‚‚å†…å®šã‚’æ´ã‚€ï¼",
        subtitle: "4ã‚¹ãƒ†ãƒƒãƒ—ã§å®Œæˆã•ã›ã‚‹æœ€å¼·ã®è‡ªå·±PR"
      }
    },
    {
      pageNumber: 2,
      templateType: "simple-items", 
      content: {
        title: "è‡ªå·±åˆ†æã®æ–¹æ³•5é¸",
        items: ["è‡ªåˆ†å²ã®ä½œæˆ", "ã€Œãªãœã€ã®æ·±æ˜ã‚Š", "ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚°ãƒ©ãƒ•", ...]
      }
    }
    // ... æ®‹ã‚Šã®ãƒšãƒ¼ã‚¸
  ],
  totalPages: 5,
  caption: "é•·æœŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³æœªçµŒé¨“ã§ã‚‚å¤§ä¸ˆå¤«ï¼ã‚¬ã‚¯ãƒã‚«ä½œæˆã®4ã‚¹ãƒ†ãƒƒãƒ—ã‚’è§£èª¬âœ¨...",
  hashtags: {
    primary: ["#ã‚¬ã‚¯ãƒã‚«", "#å°±æ´»", "#è‡ªå·±åˆ†æ"],
    secondary: ["#å°±æ´»ç”Ÿ", "#æ–°å’", "#é¢æ¥å¯¾ç­–"],
    // ...
  }
}
```

---

## âš ï¸ ç¾åœ¨ã®é‡è¦ãªå•é¡Œ

**å•é¡Œç®‡æ‰€:** ã‚¹ãƒ†ãƒƒãƒ—7ã® `extractFromKnowledgeBase()` 

**å•é¡Œå†…å®¹:** 
- ContentInputã§è‹¦åŠ´ã—ã¦AIåˆ¤å®šã§é¸æŠã—ãŸK004ãƒŠãƒ¬ãƒƒã‚¸ãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨ã«ç„¡è¦–
- å†åº¦æ¨å®šãƒ»æ¤œç´¢ã‚’è¡Œã£ã¦ã€ç²¾åº¦ã®ä½ã„çµæœã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹

**è§£æ±ºæ–¹æ³•:**
`knowledgeBaseParams.knowledgeContents` ã«å«ã¾ã‚Œã‚‹é¸æŠæ¸ˆã¿K004ãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥æ´»ç”¨ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£ãŒå¿…è¦

ã“ã‚Œã«ã‚ˆã‚Šã€è‡ªå·±åˆ†æã«é–¢ã™ã‚‹å…·ä½“çš„ãªæ‰‹æ³•ãƒ»è¡¨ç¾ãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ç¢ºã«InstagramæŠ•ç¨¿ã«åæ˜ ã•ã‚Œã‚‹ã€‚