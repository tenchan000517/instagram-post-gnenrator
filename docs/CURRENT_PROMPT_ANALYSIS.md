# 📋 PageStructureAnalyzer 現行プロンプト完全解析

## 概要
現在Geminiに送信されている実際のプロンプトを完全に分析し、section-items偏重問題の原因を特定します。

## 実際のプロンプト（strategyジャンルの場合）

```
あなたはInstagram投稿構造の専門家です。以下のコンテンツを分析し、最適なページ構造を決定してください。

【ジャンル分析結果】
- 判定ジャンル: strategy
- 最適項目数: 4-6個

【分析ステップ】
1. コンテンツから有益性の高い情報を抽出
2. Instagram投稿に適した構造で分類
3. 各セクションに最適なテンプレートを選択（データ構造に基づく）
4. 視覚的魅力と読みやすさを考慮

【重要制約】
- 入力内容の情報のみ使用（推測・憶測禁止）
- **4-8ページの適切な分量**（充実した価値あるコンテンツを重視）
- テンプレート多様性を重視
- Instagram特化の簡潔性
- **ジャンル別最適項目数の必須遵守**: 4-6個の項目を必ず含める

【入力内容】
[ここに実際の入力テキストが入る]

【テンプレート選択指針】
**🎯 データ構造による最適選択 🎯**

**データ構造による選択**
**two-column-section-items**: 以下の対比構造は必ずtwo-column-section-itemsを選択
- VS比較（A vs B、明確に2つの選択肢を左右で比較）
- 対比概念（メリット｜デメリット、準備すること｜避けること）
- 左右で異なるカテゴリの項目リスト
- **重要**: 「vs」「対」「メリット・デメリット」などの対比キーワードがある場合

**ranking**: 以下のランキング構造は必ずrankingを選択
- 順位付きデータ（1位〜5位など明確な順序）
- "ワースト"や"ベスト"など順位表現
- パーセンテージや数値付きランキング
- 順位・項目・数値の3要素が揃ったデータ
- **重要**: 「ランキング」「順位」「位」「ワースト」「ベスト」キーワードがある場合

**graph**: 以下のデータ可視化は必ずgraphを選択  
- 円グラフ向け：割合データ（%表記が含まれる）
- 棒グラフ向け：数値比較データ（時間・件数・金額など単位付き）
- データ出典情報あり（組織名・年度・発表日など）
- 複数の数値データポイントを比較する内容
- **重要**: 「グラフ」「データ」「割合」「%」「時間」「比較」「出典」キーワードがある場合

**table**: 以下の構造化データは必ずtableを選択
- 3行以上のデータ一覧（企業名｜業界｜年収など）
- 複雑な比較表（3つ以上の比較対象・多列データ）
- ツール一覧（ツール名｜機能｜価格｜評価など）
- 行と列で整理された体系的な情報（ランキング・グラフ以外）
- **重要**: 「一覧」「比較表」「ツール」キーワードがある場合（ランキング・グラフを除く）

**simple5**: 連続する手順・プロセス・ステップの詳細説明がある場合（異なるカテゴリの並列は避ける）
**list**: シンプルなチェックリスト・行動項目一覧（詳細説明なし）がある場合
**checklist-enhanced**: 各チェック項目に詳細説明がある準備リスト・手順リストがある場合  
**section-items**: 複数カテゴリ+各項目説明がある場合（概要・まとめページに最適）
**index**: 目次・インデックス形式の場合（「INDEX」「目次」「インデックス」「構成」「一覧」「ページ」キーワード）
**single-section-no-items**: 単一セクションの詳細説明（「について」「技術」「スキル」「方法」「能力」キーワード）
**two-column-section-items**: 2つのカテゴリーの比較・分類（「比較」「2つ」「カテゴリー」「分類」「準備と実行」「段階」キーワード）
**item-n-title-content**: 独立した概念・ポイントの詳細説明（**必ず4-6個の項目を生成**）

【品質基準】
- 具体的数値・期間・手法を含む実用性
- スマホ画面での瞬間理解度
- 行動につながる価値提供
- **各ページに4-6個の充実した項目を含める**
- **2個以下は物足りないため禁止**

【出力形式JSON】
[
  {
    "概要": "具体的内容要約",
    "有益性": "読者への価値",
    "template": "最適テンプレート名",
    "title": "魅力的タイトル",
    "theme": "詳細テーマ説明"
  }
]

**重要**: 各ページは必ず4-6個の項目を含むよう設計し、2個以下の少ない項目数は避けること。
```

## 🔍 問題点の詳細分析

### 1. テンプレート選択順序の問題

現在の構造：
```
1. two-column-section-items → 詳細な条件
2. ranking → 詳細な条件
3. graph → 詳細な条件
4. table → 詳細な条件
5. simple5 → 曖昧な条件
6. list → 曖昧な条件
7. checklist-enhanced → 曖昧な条件
8. section-items → 曖昧な条件
```

**問題**: 上位のテンプレート（two-column、ranking、graph、table）は詳細な条件があるが、下位のテンプレート（simple5、list、checklist-enhanced、section-items）は**1行の曖昧な説明**のみ。

### 2. checklist-enhanced の選択条件

現在の条件：
```
**checklist-enhanced**: 各チェック項目に詳細説明がある準備リスト・手順リストがある場合
```

**問題点**：
- 「準備リスト・手順リスト」の判定基準が不明確
- □記号への言及なし
- strategyジャンルとの関連性なし
- 「詳細説明がある」の定義が曖昧

### 3. section-items の選択条件

現在の条件：
```
**section-items**: 複数カテゴリ+各項目説明がある場合（概要・まとめページに最適）
```

**問題点**：
- **過度に汎用的**（ほぼ全てのコンテンツが該当）
- 「複数カテゴリ」の定義が曖昧（2つ以上？）
- 「各項目説明」は他のテンプレートでも該当

### 4. item-n-title-content の選択条件

現在の条件：
```
**item-n-title-content**: 独立した概念・ポイントの詳細説明（**必ず4-6個の項目を生成**）
```

**問題点**：
- 「独立した概念」が広すぎる
- checklist-enhancedとの違いが不明確
- 結果的に多くのページがこれを選択

## 📊 実際のAI判定パターン

テスト結果から見えるAIの判定ロジック：

1. **ページ1**: 「面接準備完全攻略ロードマップ」
   - AIの判定：「全体像」「ロードマップ」→ **section-items**
   - 理由：概要・まとめページと認識

2. **ページ2-6**: 各準備項目の詳細
   - AIの判定：「独立した概念の詳細説明」→ **item-n-title-content**
   - 理由：4-6個の項目という条件に合致

## 🎯 根本原因

### 1. **ジャンル特性の無視**
- プロンプトにstrategyジャンルの特性記載なし
- 対策系コンテンツへの配慮なし

### 2. **優先順位の欠如**
- 全テンプレートが並列で提示
- 優先度や推奨の概念なし

### 3. **条件の具体性の差**
- 上位4テンプレート：具体的な条件と複数の例
- 下位8テンプレート：1行の曖昧な説明

### 4. **□記号の認識不足**
- □記号付きリストへの言及なし
- チェックリスト形式の明示的な判定基準なし

## 💡 改善の方向性

### 1. **ジャンル特性の前置**
```
【strategyジャンル特別指針】
- 対策・準備系コンテンツは**checklist-enhanced最優先**
- □記号付きリストは**checklist-enhanced**
- 避けるべき：section-items
```

### 2. **テンプレート選択条件の具体化**
```
**checklist-enhanced**: 以下の条件で最優先選択
✅ strategyジャンルの対策・準備系コンテンツ
✅ □記号付きのチェックリスト形式
✅ 各項目に実践的な説明がある
✅ 「準備」「対策」「手順」「攻略」キーワード
```

### 3. **section-items条件の厳格化**
```
**section-items**: 以下の厳格な条件を全て満たす場合のみ
❌ 単純な準備リストは除外
❌ 対策系コンテンツは除外
✅ 5つ以上の独立カテゴリ
✅ 「まとめ」「総括」明示キーワード必須
```

これらの分析結果から、プロンプトの構造と条件設定に明確な問題があることが判明しました。