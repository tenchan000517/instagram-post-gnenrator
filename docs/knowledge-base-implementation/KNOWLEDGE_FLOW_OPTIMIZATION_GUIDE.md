# ナレッジフロー投稿内容最適化ガイド

## 🎯 概要

ナレッジフローで生成される投稿内容を最適化するための詳細ガイド。どのファイルを修正すると、どの部分にどのような影響があるかを詳しく解説します。

---

## 📁 ファイル構成と影響範囲

### **Level 1: コンテンツ生成の核心部分**

#### 1. `app/services/knowledgeBase/TemplateItemMapper.ts`
**影響範囲**: 🔥 **最重要** - 全ページの内容生成
**修正内容と効果**:

```typescript
// 📍 修正箇所1: buildMappingPrompt() - Line 136-173
// 効果: 全ページのタイトル・内容・項目の品質向上
private buildMappingPrompt(input: string, page: PageDefinition, targetCombination: string): string {
```

**具体的な修正例**:
- **プロンプト調整** → **タイトルの魅力度向上**
- **抽出ルール強化** → **より具体的な内容生成**
- **文体指示追加** → **ターゲットに刺さる表現**

#### 2. `app/services/knowledgeBase/TemplateItemMapper.ts`
**影響範囲**: 🔥 **最重要** - テンプレート別の内容品質
**修正内容と効果**:

```typescript
// 📍 修正箇所2: getTemplateSpecificInstructions() - Line 179-210
// 効果: 各テンプレートに最適化された内容生成
private getTemplateSpecificInstructions(templateId: string): string {
```

**具体的な修正例**:
- **section-items指示強化** → **より実践的な項目内容**
- **enumeration指示改善** → **具体的なメリット列挙**
- **ranking指示追加** → **データ根拠のある内容**

---

### **Level 2: ページ構造・戦略部分**

#### 3. `app/services/knowledgeBase/data/pageStructures/*.json`
**影響範囲**: 🔥 **重要** - 特定パターンのページ構成
**修正内容と効果**:

##### 3.1 `empathy-strategic-solution-5page.json`
```json
// 📍 修正箇所: extractionRule - 各ページの抽出指示
"extractionRule": "戦略的だからこそ感じる不安・迷いを抽出"
```

**修正例と効果**:
- **修正前**: `"戦略的だからこそ感じる不安・迷いを抽出"`
- **修正後**: `"戦略的思考タイプが『本当にこのやり方で大丈夫？』と感じる具体的な不安・迷いを3つ抽出"`
- **効果**: より具体的でターゲットに刺さる内容

##### 3.2 各ページの `itemCount` 調整
```json
// 📍 修正箇所: itemCount - 項目数の最適化
"itemCount": 3  // → 4や5に変更可能
```

**効果**: 情報量と読みやすさのバランス調整

---

### **Level 3: データマスター・知識ベース部分**

#### 4. `app/services/knowledgeBase/data/masterData/personas.json`
**影響範囲**: 🟡 **中程度** - ペルソナ別の内容調整
**修正内容と効果**:

```json
// 📍 修正箇所: psychologicalNeeds - 心理的ニーズ
"psychologicalNeeds": ["確実性", "優位性", "効率性"]
```

**修正例と効果**:
- **修正前**: `["確実性", "優位性", "効率性"]`
- **修正後**: `["『正解』への安心感", "『差別化』できる優位性", "『最短距離』での効率性"]`
- **効果**: より具体的な心理状態に基づいた内容生成

#### 5. `app/services/knowledgeBase/data/masterData/themes.json`
**影響範囲**: 🟡 **中程度** - テーマ別の内容方向性
**修正内容と効果**:

```json
// 📍 修正箇所: keywords - キーワード追加
"keywords": ["自己分析", "強み発見", "価値観"]
```

**修正例と効果**:
- **追加キーワード**: `["不安解消", "正しいやり方", "効率化"]`
- **効果**: より多角的な内容生成

---

## 🔧 具体的な最適化手順

### **Phase 1: プロンプト最適化（即効性大）**

#### Step 1: タイトル魅力度向上
**ファイル**: `TemplateItemMapper.ts` - Line 165-169
**修正内容**:
```typescript
// 現在
- タイトルは必ず「〇〇！：〇〇」または「〇〇：〇〇」の形式で作成する

// 最適化後
- タイトルは「【〇〇必見】〇〇！：〇〇」「〇〇が知らない：〇〇の真実」形式で作成
- ターゲットの課題を明確に示し、解決への期待感を高める
- 数字や具体性を含める（例：「3つの罠」「5ステップ」）
```

#### Step 2: 内容の具体性向上
**ファイル**: `TemplateItemMapper.ts` - Line 181-184
**修正内容**:
```typescript
// 現在
- sections配列の各セクションに対応する項目を生成
- 各項目は簡潔で具体的な内容にする

// 最適化後
- 各項目は「なぜそうなるのか」「どうすれば解決できるのか」を明確に示す
- 読者が「これは自分のことだ」と感じる具体的なシチュエーションを含める
- 抽象的な表現は避け、実際の行動に直結する内容にする
```

### **Phase 2: ページ構成最適化（効果持続）**

#### Step 3: 抽出ルール強化
**ファイル**: `pageStructures/empathy-strategic-solution-5page.json`
**修正箇所**: 各ページの `extractionRule`

**現在 → 最適化後**:
```json
// Page 1: 共感フック
"extractionRule": "戦略的だからこそ感じる不安・迷いを抽出"
↓
"extractionRule": "『効率的にやりたいのに、自己分析って感情的な部分もあって戸惑う』という戦略的思考タイプの具体的な悩みを3つ抽出"

// Page 2: 問題分析  
"extractionRule": "戦略的アプローチの限界・問題点を分析"
↓
"extractionRule": "『データと論理で攻めたいのに、うまくいかない』理由を具体的な失敗パターンとして3つ分析"

// Page 3: 解決策
"extractionRule": "感情認識＋戦略思考の統合手法を提示"
↓
"extractionRule": "感情面も考慮しつつ戦略的に進める『具体的な方法論』を4つ提示（手順・ツール・考え方を含む）"
```

### **Phase 3: ペルソナ・テーマ最適化（根本改善）**

#### Step 4: ペルソナ特性の深掘り
**ファイル**: `masterData/personas.json`
**修正箇所**: P001の各フィールド

```json
// 現在
"characteristics": ["効率重視", "データ志向", "計画的"]

// 最適化後
"characteristics": [
  "『正解』を求める完璧主義傾向",
  "データと論理を重視するが感情面で迷いがち", 
  "効率性と確実性の両立を求める",
  "『他の人はどうしてるの？』が気になる"
]
```

---

## 📊 修正による影響度マップ

| 修正箇所 | 影響度 | 即効性 | 持続性 | 修正難易度 |
|---------|-------|-------|-------|-----------|
| TemplateItemMapper.ts (プロンプト) | 🔥🔥🔥 | ⚡⚡⚡ | ⭐⭐⭐ | 🟢 簡単 |
| pageStructures/*.json (抽出ルール) | 🔥🔥 | ⚡⚡ | ⭐⭐⭐ | 🟡 中程度 |
| masterData/personas.json | 🔥 | ⚡ | ⭐⭐⭐ | 🟡 中程度 |
| masterData/themes.json | 🔥 | ⚡ | ⭐⭐ | 🟡 中程度 |

---

## 🎯 推奨最適化順序

### **第1段階: 即効性重視（30分程度）**
1. `TemplateItemMapper.ts` のプロンプト調整
2. タイトル形式の魅力度向上
3. 内容生成指示の具体化

### **第2段階: 持続効果重視（1時間程度）**  
1. `pageStructures/*.json` の抽出ルール強化
2. 各ページの項目数最適化
3. ページ間の論理的流れ改善

### **第3段階: 根本改善（2時間程度）**
1. ペルソナ定義の深掘り
2. テーマキーワードの拡充
3. 新しいページ構成パターンの検討

---

## 🔍 効果測定方法

### **定量指標**
- タイトルの魅力度（コロン使用率、具体性）
- 内容の具体性（抽象語vs具体語の比率）
- ユーザー関連性（「自分のこと」感の強さ）

### **定性指標**  
- ターゲットペルソナとの適合度
- 実践可能性の高さ
- 読了後の行動意欲

---

**💡 重要**: 修正は段階的に行い、各段階で生成結果を確認しながら進めることを推奨します。