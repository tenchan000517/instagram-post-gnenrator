## Step 1: データベース構造確認

まず、habit-behavior-database.jsonの現在の構造を確認します。
以下のコマンドで必要な情報を取得してください：

```bash
# 現在のカテゴリ数を確認
grep -c '"id": "CAT' ../../02_ACTIVE_CONTENTS/data-systems/03_DATABASE/habit-databases/habit-behavior-database.json

# 最後のカテゴリIDを確認  
grep '"id": "CAT' ../../02_ACTIVE_CONTENTS/data-systems/03_DATABASE/habit-databases/habit-behavior-database.json | tail -1

# 最後のhabitIdを確認
grep '"habitId": "H' ../../02_ACTIVE_CONTENTS/data-systems/03_DATABASE/habit-databases/habit-behavior-database.json | tail -1

# 現在のtotalEntriesを確認
grep '"totalEntries"' ../../02_ACTIVE_CONTENTS/data-systems/03_DATABASE/habit-databases/habit-behavior-database.json
```

## Step 2: 新カテゴリ用データ変換

収集した習慣データを統合用の新カテゴリとして変換してください：

【入力データ】
[収集済みの習慣情報]

【現在のデータベース情報】
- 最後のカテゴリID: [Step1で確認した値]
- 最後のhabitId: [Step1で確認した値] 
- 現在のtotalEntries: [Step1で確認した値]

【出力構造】
{
  "id": "CAT009",
  "name": "[カテゴリ名]",
  "description": "[カテゴリの説明]",
  "habits": [
    {
      "habitId": "G001",
      "habitName": "[20文字以内]",
      "category": "CAT009",
      "shortDescription": "[30文字以内]",
      "detailedDescription": "[200文字以内]",
      "targetPersona": ["対象者タイプの配列"],
      "effectiveness": {
        "overallScore": [0-100],
        "productivity": [0-100],
        "wellbeing": [0-100],
        "career": [0-100],
        "learning": [0-100]
      },
      "practiceRate": [実践率%],
      "evidence": {
        "primarySource": "主要出典",
        "additionalSources": ["追加出典の配列"],
        "sampleSize": [数値],
        "studyYear": [年],
        "reliabilityLevel": "[A/B/C]"
      },
      "implementation": {
        "difficulty": "[低/中/高]",
        "timeRequired": "習慣化期間",
        "dailyTime": "1日の所要時間",
        "cost": "[無料/低額/高額]",
        "tools": ["必要ツールの配列"]
      },
      "tips": {
        "startingTips": ["開始のコツ3つ"],
        "commonMistakes": ["よくある失敗3つ"],
        "successIndicators": ["成功の兆候3つ"]
      },
      "relatedHabits": ["関連習慣IDの配列"],
      "characterRecommendation": {
        "king": [0-100],
        "misaki": [0-100],
        "iida": [0-100],
        "ten": [0-100]
      }
    }
  ]
}

【変換ルール】
1. 不明な項目は"null"でなく適切なデフォルト値を設定
2. スコアは相対評価でなく絶対評価で設定
3. キャラクター推奨度は習慣の特性から自動判定
4. habitIdは既存のH001-H035と重複しないよう、G001から開始

## Step 3: 自動統合・保存実行

**重要**: Step 2で生成したJSONデータを実際に../../02_ACTIVE_CONTENTS/data-systems/03_DATABASE/habit-databases/habit-behavior-database.jsonに保存します。

### 3-1. 現在のデータベース内容を読み込み
以下のコマンドで現在のデータベースを確認・バックアップ：

```bash
# バックアップ作成
cp ../../02_ACTIVE_CONTENTS/data-systems/03_DATABASE/habit-databases/habit-behavior-database.json ../../02_ACTIVE_CONTENTS/data-systems/03_DATABASE/habit-databases/habit-behavior-database.json.backup

# categories配列の終了位置を確認
grep -n '    ],' ../../02_ACTIVE_CONTENTS/data-systems/03_DATABASE/habit-databases/habit-behavior-database.json | head -1
```

### 3-2. 段階的データベース統合・保存

**重要**: 1,732行の巨大ファイルは段階的に処理します。

#### 段階A: categories配列終了位置の特定
```bash
# categories配列の終了行を特定
grep -n '    ],' ../../02_ACTIVE_CONTENTS/data-systems/03_DATABASE/habit-databases/habit-behavior-database.json | head -1
```

#### 段階B: 該当部分のみ読み込み・編集
categories配列の終了部分（約1695-1700行周辺）のみを読み込んで、新カテゴリを挿入してください：

**指示**:
1. ../../02_ACTIVE_CONTENTS/data-systems/03_DATABASE/habit-databases/habit-behavior-database.jsonの1695-1700行周辺を読み込む
2. "categories"配列の終了直前（`],`の行の前）にStep 2のカテゴリオブジェクトを挿入
3. カンマ区切りを正しく処理（最後のカテゴリの後にカンマ追加）

#### 段階C: メタデータ更新
ファイル冒頭部分（1-10行）のメタデータを更新：
- "totalEntries": 35 → 45
- "lastUpdated": "2025-08-25"

#### 段階D: 保存完了確認
```bash
# JSON構文チェック
python -m json.tool ../../02_ACTIVE_CONTENTS/data-systems/03_DATABASE/habit-databases/habit-behavior-database.json > /dev/null
echo "構文チェック結果: $?"
```

**出力**: 各段階の完了確認メッセージ

### 3-3. 統合結果の検証
保存後、以下で正常性を確認：

```bash
# JSON構文チェック
python -m json.tool ../../02_ACTIVE_CONTENTS/data-systems/03_DATABASE/habit-databases/habit-behavior-database.json > /dev/null
echo "JSON構文チェック結果: $?"

# 新カテゴリが追加されたか確認
grep -c '"id": "CAT' ../../02_ACTIVE_CONTENTS/data-systems/03_DATABASE/habit-databases/habit-behavior-database.json

# 新習慣が追加されたか確認
grep '"totalEntries"' ../../02_ACTIVE_CONTENTS/data-systems/03_DATABASE/habit-databases/habit-behavior-database.json
```

### 3-4. 失敗時の復旧
統合に失敗した場合：
```bash
mv ../../02_ACTIVE_CONTENTS/data-systems/03_DATABASE/habit-databases/habit-behavior-database.json.backup ../../02_ACTIVE_CONTENTS/data-systems/03_DATABASE/habit-databases/habit-behavior-database.json
echo "データベースを復旧しました"
```