# ページ構成・テンプレート設計方針（最終版）

## 📋 概要

このドキュメントは、Instagram投稿生成システムにおけるページ構成とテンプレートの設計方針を定めたものです。

**策定日**: 2025-07-25  
**重要度**: 最高 - システム実装の基礎設計  
**適用範囲**: 全TypeID（001-004）のテンプレート生成システム

---

## 🎯 基本概念の定義

### **1. ページ構成 vs テンプレートの明確な分離**

#### **ページ構成**
- **定義**: セクションの有無組み合わせ
- **例**: intro + mainContent + summary
- **特徴**: 構造的な枠組み

#### **テンプレート**  
- **定義**: 各セクション内の表現方法・要素構成
- **例**: 並列紹介テンプレート、Q&Aテンプレート
- **特徴**: 具体的な表現パターン

### **2. セクション分割の唯一の基準**

**「テンプレートが変わる = セクションが分かれる」**

#### **具体例**
```
K027の場合:
Page 2: 問題共感テンプレート → セクション1
Page 3: 解決導入テンプレート → セクション2
Page 4-7: Q&Aテンプレート → セクション3（同一テンプレートなので1セクション）
Page 8: 実践Tipsテンプレート → セクション4
```

```
K113の場合:
Page 2: 導入テンプレート → セクション1
Page 3-9: 並列紹介テンプレート → セクション2（同一テンプレートなので1セクション）
Page 10: まとめテンプレート → セクション3
```

---

## 🎨 テンプレート構造の統合

### **基本テンプレート構造: 2パターン**

#### **テンプレート1: 順序重要型**
- **基本構造**: 項目番号/時点 + タイトル + 説明 + 繋がり要素
- **順序依存性**: あり（順序を変えると意味が変わる）
- **適用例**:
  - STEP01→STEP02→STEP03（順序依存）
  - 時点1（大学3年）→時点2（就活意識）→時点3（比較・焦り）（時系列ストーリー）

#### **テンプレート2: 並列型**
- **基本構造**: 項目タイトル + 内容 + 補足
- **順序依存性**: なし（順序を変えても各項目の価値は独立）
- **適用例**:
  - 機能1 + 機能2 + 機能3（並列紹介）
  - Q1 + Q2 + Q3（Q&A）

### **重要な認識**
**フロー**（内容の性質）≠ **テンプレート構造**（表現の枠組み）

異なるフローでも同じテンプレート構造を使用可能

---

## 🔧 Kxxx.json実装方針

### **現在の構造**
```json
"page2": {
  "role": "導入・概要ページ",
  "layout": "世界地図背景 + 説明文",
  "content": { ... }
}
```

### **新しい構造（sectionフィールド追加）**
```json
"page2": {
  "section": "intro",  // ← 新規追加
  "role": "導入・概要ページ",
  "layout": "世界地図背景 + 説明文",
  "content": { ... }
},
"page3": {
  "section": "mainContent",  // ← 新規追加
  "role": "機能1：スタンプゲーム",
  "layout": "機能説明 + 実例画像 + 効果説明",
  "content": { ... }
}
```

### **セクション種別の定義**

#### **基本セクション**
- **`intro`**: 導入・概要説明
- **`mainContent`**: メインコンテンツ（情報提供・解決策）
- **`summary`**: まとめ・行動促進

#### **拡張セクション**
- **`problemEmpathy`**: 問題共感（TypeID=001で使用）
- **`solutionIntro`**: 解決方法導入
- **`practicalTips`**: 実践的Tips
- **`dataPresentation`**: データ提示
- **`pointsList`**: ポイントリスト

---

## 💻 プロンプトでの活用方法

### **セクション別ページ取得**
```javascript
// intro部分のページを取得
const introPages = Object.values(detailedContent).filter(page => page.section === 'intro');

// mainContent部分のページを取得
const mainPages = Object.values(detailedContent).filter(page => page.section === 'mainContent');

// summary部分のページを取得
const summaryPages = Object.values(detailedContent).filter(page => page.section === 'summary');
```

### **ページ構成パターンの動的判定**
```javascript
// ページ構成パターンを動的に判定
const sections = [...new Set(Object.values(detailedContent).map(page => page.section))];
const pageStructurePattern = sections.join('_');
// 例: "intro_mainContent_summary" or "problemEmpathy_solutionIntro_mainContent_summary"
```

### **テンプレート選択の自動化**
```javascript
// セクション種別に基づいてテンプレートを自動選択
const templateMap = {
  'intro': 'basic_intro',
  'mainContent': determineMainContentTemplate(pages), // 動的決定
  'summary': 'action_promotion',
  'problemEmpathy': 'emotional_sharing'
};
```

---

## 📊 実装上の利点

### **1. 既存構造との整合性**
- 既存の`detailedContent`構造を最小限の変更で活用
- `pageCount`や`role`などの既存フィールドとの共存

### **2. 実装の簡素化**
- セクション判別が各ページで自己完結
- プロンプト側でのデータ処理が単純化
- 新しいセクション種別の追加が容易

### **3. 柔軟性の確保**
- introが2ページある場合、それぞれ異なるテンプレート対応可能
- セクション組み合わせの自由度が高い
- TypeID間での構造の統一性

### **4. 保守性の向上**
- セクション定義の一元管理
- テンプレート変更の影響範囲が明確
- デバッグ・トラブルシューティングが容易

---

## 🎯 次のステップ

### **Phase 1: 基本実装**
1. 既存Kxxx.jsonへの`section`フィールド追加
2. 基本セクション（intro, mainContent, summary）の定義
3. プロンプトでのセクション別処理実装

### **Phase 2: 拡張実装**
1. 拡張セクション（problemEmpathy等）の追加
2. テンプレート自動選択機能の実装
3. ページ構成パターンの動的判定

### **Phase 3: 最適化**
1. テンプレートバリエーションの実装
2. セクション組み合わせの最適化
3. 100点マッチングシステムとの統合

---

## 📝 設計原則

### **1. シンプルさの追求**
「テンプレートが変わる = セクションが分かれる」の単純な基準

### **2. 実装の現実性**
既存システムとの整合性を重視した段階的実装

### **3. 拡張性の確保**
新しいセクション・テンプレートの追加に対応可能な柔軟な設計

### **4. 保守性の重視**
明確な責任分離と一元管理による保守性の確保

---

**この設計方針により、Instagram投稿生成システムのページ構成・テンプレート管理が大幅に改善され、100点マッチングシステムの基盤が整備されます。**