# ナレッジファイルディレクトリ構造変更の影響分析

## 変更内容
現在: `app/data/knowledgeBase/knowledge/K001.json`
変更後: `app/data/knowledgeBase/knowledge/type001/K001.json`

## 影響を受けるコンポーネント

### 1. **MasterDataService.ts** (主要影響箇所)
- **場所**: `/app/services/knowledgeBase/MasterDataService.ts`
- **行番号**: 129行目
- **現在のコード**:
```typescript
const module = await import(`../../data/knowledgeBase/knowledge/${knowledgeId}.json`)
```
- **変更必要**: postTypeを取得してディレクトリパスを動的に構築する必要がある

### 2. **test-single-page/page.tsx** (テスト用)
- **場所**: `/app/test-single-page/page.tsx`
- **行番号**: 21行目
- **現在のコード**:
```typescript
const module = await import(`../data/knowledgeBase/knowledge/K115.json`)
```
- **変更必要**: type001ディレクトリを含むパスに変更

## その他の潜在的な影響箇所

### 3. **ドキュメント内のパス参照**
以下のドキュメントに記載されているパスも更新が必要:
- 各種引き継ぎ書
- 緊急引き継ぎ書
- 次世代Claude_Code関連ドキュメント

### 4. **分析結果JSONファイル**
- `knowledge-analysis-results-v2.json`
- `knowledge_analysis_summary.json`
これらは参照のみなので実行時影響はないが、一貫性のため更新推奨

## 実装上の課題

### postType情報の取得方法
1. **問題**: MasterDataServiceでナレッジファイルを読み込む際、postTypeが不明
2. **解決案**:
   - A. knowledgeIdとpostTypeのマッピングテーブルを作成
   - B. 全typeディレクトリを検索してファイルを探す
   - C. type-target-persona-relations.jsonに情報を追加

### 推奨アプローチ
**解決案A**が最も効率的:
- `knowledgeTypeMapping.json`を作成
- KxxxとpostTypeの対応表を管理
- MasterDataServiceで参照

## 移行手順

1. knowledgeTypeMappingファイルの作成
2. MasterDataServiceの更新
3. ディレクトリ構造の作成とファイル移動
4. テストページの更新
5. 動作確認

## 注意事項
- バックアップを必ず取る
- 段階的な移行を推奨（一度に全ファイルを移動しない）
- エラーハンドリングの強化が必要