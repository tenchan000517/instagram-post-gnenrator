# 📋 NEW FLOW DESIGN - Instagram Post Generator 新フロー設計

## 🎯 新フロー概要

### **設計背景**
現在のシステムは「生成されたコンテンツが削られる」問題があり、AIが生成した豊富なコンテンツがテンプレート適用時に劣化している。

### **根本問題**
- AIが「項目:」「セクション:」構造でコンテンツ生成
- JavaScriptがそれを「抽出」「分解」「再構築」
- 結果として情報が劣化し、不完全なコンテンツになる

## 🚀 新フロー設計

### **理想的なフロー**
```
①コンテンツ生成 → ②推奨テンプレート表示 → ③テンプレート選択 → ④AI最適配置 → ⑤部分編集 → ⑥完成・ダウンロード
```

### **各ステップの詳細**

#### **①コンテンツ生成**
- **目的**: 純粋な高品質コンテンツ生成
- **要件**: 
  - 事実ベースのコンテンツのみ
  - 憶測・推測は含めない
  - テンプレート構造に縛られない自由な生成

#### **②推奨テンプレート + 概要表示**
- **目的**: ユーザーにテンプレート選択の判断材料を提供
- **表示内容**:
  - 推奨テンプレート（1-3個）
  - 各テンプレートの適用イメージ
  - どのような表現に適しているかの説明
- **要件**: ユーザーが選択前に結果を想像できること

#### **③テンプレート選択**
- **選択肢**:
  - 推奨テンプレートを使用
  - 手動で別のテンプレートに変更
- **UX要件**: 簡単に変更可能

#### **④AIによる最適配置**
- **🚨重要制約**: 
  - **コンテンツの改変は一切しない**
  - **付け足しや文言変更は禁止**
  - **純粋にテンプレートの適切な場所に配置するだけ**
- **実装要件**:
  - 生成されたコンテンツをテンプレートの各エリアに最適配置
  - テンプレートには配置場所を明確に定義

#### **⑤部分的直接編集**
- **編集可能要素**:
  - タイトル
  - 項目リスト
  - 説明文
  - その他テンプレート固有の要素
- **要件**: ピンポイントで編集可能

#### **⑥完成・ダウンロード**
- **機能**: 完成されたコンテンツの画像出力
- **要件**: 現在の品質を維持

## 🔧 実装計画

### **新しいサービス**

#### **ContentLayoutService**
- **責務**: コンテンツをテンプレートに配置（改変なし）
- **主要機能**:
  - `layoutContentToTemplate(content, templateType)` - コンテンツ配置
  - 配置ルールの定義と適用

#### **TemplateRecommendationService**
- **責務**: 生成されたコンテンツに対する最適テンプレート推奨
- **主要機能**:
  - `recommendTemplates(content)` - 推奨テンプレート生成
  - `getTemplatePreview(content, templateType)` - 適用イメージ生成

### **新しいコンポーネント**

#### **TemplateSelectionComponent**
- **責務**: テンプレート選択UI
- **表示内容**:
  - 推奨テンプレートリスト
  - 各テンプレートの適用イメージ
  - 選択UI

#### **PartialEditComponent** 
- **責務**: 部分編集UI
- **機能**:
  - インライン編集
  - 要素別編集フォーム
  - リアルタイムプレビュー

#### **ContentLayoutPreviewComponent**
- **責務**: 配置結果のプレビュー表示
- **機能**:
  - 配置後のコンテンツ確認
  - 編集前の最終確認

### **フロー制御**

#### **NewFlowController**
- **責務**: 新フローの全体制御
- **ステート管理**:
  - 現在のフロー段階
  - 各段階のデータ
  - ユーザーの承認状況

### **テンプレート改善**

#### **配置エリアの明確化**
- **要件**: 各テンプレートでコンテンツ配置場所を明確に定義
- **実装**:
  - `TemplateArea` 型定義
  - 配置ルールの文書化
  - プレースホルダー情報の整理

## 🎯 成功指標

### **品質指標**
- **コンテンツ劣化ゼロ**: 生成されたコンテンツが削られない
- **配置精度**: 適切なテンプレートエリアに正確に配置
- **編集柔軟性**: 必要な部分だけピンポイント編集可能

### **UX指標**
- **選択しやすさ**: テンプレート選択が直感的
- **編集しやすさ**: 部分編集が簡単
- **プレビュー精度**: 選択前に結果が想像できる

## 🚨 重要な制約

### **AIの役割分担**
- **コンテンツ生成**: 自由度の高い高品質生成
- **配置処理**: 改変なしの純粋配置のみ
- **編集支援**: ユーザーの直接編集をサポート

### **開発優先順位**
1. **ContentLayoutService** - 核心機能
2. **TemplateRecommendationService** - UX向上
3. **新しいコンポーネント群** - UI実装
4. **フロー制御** - 全体統合

## 📝 備考

- 現在のテンプレートシステムは活用しつつ、配置ロジックを改善
- 既存のhtml2canvas機能は維持
- 段階的な実装により、各段階での品質確認を行う