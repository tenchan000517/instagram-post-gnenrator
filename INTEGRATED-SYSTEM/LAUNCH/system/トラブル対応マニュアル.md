# トラブル対応マニュアル

**対象**: 緊急トラブル・問題解決  
**目的**: システム障害時の迅速な復旧・問題解決  
**重要度**: ★★★★★ (最高)

---

## 🚨 **緊急時対応手順**

### **🔴 即座実行（最優先）**
```
1. 作業即座停止
2. 現状の詳細記録
3. ユーザーへの状況報告
4. バックアップからの復旧準備
```

### **⚠️ 被害拡大防止**
```
1. 追加変更禁止
2. 自動処理停止
3. データベース書き込み禁止
4. システム分離（必要時）
```

---

## 🔧 **問題分類別対応**

## **1. 起動術式実行エラー**

### **症状A: 参照ファイルが見つからない**
```
エラー例: "INTEGRATED-SYSTEM/RESOURCES/women-content/xxx.md が存在しません"

【原因】
- ファイルパス間違い
- ファイル移動漏れ
- ファイル名変更

【対処手順】
1. 該当ディレクトリの存在確認
   ls -la INTEGRATED-SYSTEM/RESOURCES/women-content/
2. ファイル名の正確性確認
   find INTEGRATED-SYSTEM/RESOURCES -name "*女性向け*"
3. パス修正または ファイル復旧
4. 起動術式再実行
```

### **症状B: 品質レベルが想定と異なる**
```
エラー例: "初稿レベルの品質で生成されてしまう"

【原因】
- 最適化モード起動忘れ  
- 品質基準ファイル参照エラー
- キャラクター設定不整合

【対処手順】
1. 起動術式内「最適化モード起動」確認
2. SPECS/quality-specs/の参照確認
3. キャラクター固有設定の確認
4. 段階的品質チェック実行
```

### **症状C: テンプレート適用エラー**
```
エラー例: "テンプレート構造に適合しません"

【原因】
- テンプレートファイル破損
- 構造定義不整合
- データ型不一致

【対処手順】  
1. app/services/knowledgeBase/data/pageStructures/ 確認
2. テンプレートJSON構造検証
3. 対象ナレッジの構造確認
4. 構造マッチング手動実行
```

---

## **2. データベース関連エラー**

### **症状A: データベースアクセスエラー**
```
エラー例: "app/data/companyDatabase/companyMasterData.json 読み込みエラー"

【原因】
- ファイル破損
- アクセス権限問題  
- JSON構造エラー

【対処手順】
1. ファイル存在・サイズ確認
   ls -la app/data/companyDatabase/
2. JSON構文検証
   python -m json.tool app/data/companyDatabase/companyMasterData.json
3. バックアップからの復旧
4. データ整合性チェック実行
```

### **症状B: ランキング生成エラー**
```  
エラー例: "ランキング計算でNullPointerException"

【原因】
- データ不整合
- 計算式エラー
- 必須フィールド不足

【対処手順】
1. 対象データベースの整合性チェック
2. ランキング計算スクリプト確認
3. サンプルデータでの動作テスト  
4. 段階的データ復旧
```

---

## **3. キャラクター別トラブル**

### **MISAKI関連**
```
【よくある問題】
- ナレーション文字数超過（530文字制限）
- 温かいトーン不一致  
- 参照ファイル4個の不整合

【対処法】
1. MISAKI_ナレーション作成_マニュアル.md 再確認
2. 文字数自動チェック機能実行
3. トーン調整ルール適用
4. 参照ファイル4個の存在・内容確認
```

### **KING関連**
```
【よくある問題】  
- 140項目チェック機能エラー
- 男性向けトーン不統一
- 実践習得型構造不整合

【対処法】
1. T010基準ファイル確認
2. チェックリスト項目の正確性確認
3. 論理的表現パターン適用
4. 成果重視型構造の再適用
```

### **KIKUYO/TEN関連**
```
【よくある問題】
- 8データベース横断処理エラー
- ランキング情報不整合
- 複数DB参照時のタイムアウト

【対処法】  
1. 各データベースの個別動作確認
2. 横断処理の段階的実行
3. タイムアウト設定の調整
4. キャッシュ機能の活用
```

### **IIDA関連**
```
【よくある問題】
- ロードマップ10章参照エラー
- 就活指導型トーン不適切
- 実践的価値提供レベル不足

【対処法】
1. career-roadmap/ディレクトリ確認
2. 就活段階の正確な特定
3. 指導型表現パターン適用  
4. 実用性チェック実行
```

---

## **4. システム全体トラブル**

### **症状A: プログラム本体エラー**
```
エラー例: "Next.jsアプリケーションが起動しない"

【原因】
- app/ディレクトリの意図しない変更
- 依存関係の破損
- 環境設定問題

【対処手順】  
1. app/ディレクトリの変更確認
   git status app/
2. 変更があれば即座復旧
   git checkout app/
3. 依存関係再インストール
   npm install
4. 開発サーバー再起動
```

### **症状B: 大量ファイル破損**
```
エラー例: "複数システムが同時に機能しない"

【原因】
- 大規模な構造変更ミス
- 一括処理での予期しない影響
- ディスク領域不足

【緊急対処手順】
1. 全システム即座停止
2. ARCHIVE/バックアップから完全復旧準備
3. ユーザーへの詳細報告
4. 段階的復旧計画立案
```

---

## **5. パフォーマンス問題**

### **症状A: 生成時間大幅超過**
```
目標: フィード10分、リール20分
実際: 30分以上

【原因分析】
- AIサービス応答遅延
- データベース処理ボトルネック
- 並列処理の阻害

【対処法】
1. 処理時間の詳細測定
2. ボトルネック特定
3. 並列処理の最適化
4. キャッシュ活用強化
```

### **症状B: メモリ不足エラー**
```
エラー例: "JavaScript heap out of memory"

【対処手順】
1. Node.jsメモリ上限拡張
   export NODE_OPTIONS="--max-old-space-size=4096"
2. 不要なオブジェクト解放
3. 処理の分割実行
4. ガベージコレクション強制実行
```

---

## **6. 品質問題**

### **症状A: 一貫性欠如**  
```
問題: キャラクター間でトーンが混在

【対処手順】
1. CHARACTER-STRATEGY-MASTER-GUIDE.md 再確認
2. キャラクター固有設定の再適用
3. 一貫性チェック実行
4. 手動品質確認
```

### **症状B: データ整合性エラー**
```
問題: 参照関係の不整合

【対処手順】
1. 参照関係マップ作成
2. 整合性チェックスクリプト実行
3. 不整合箇所の特定・修正
4. 全体整合性の再検証
```

---

## 🔄 **復旧手順**

### **レベル1: 部分復旧**
```
対象: 個別ファイル・機能の問題

1. 問題箇所の特定・分離
2. バックアップから該当ファイル復旧  
3. 整合性チェック
4. 動作テスト
5. 段階的再統合
```

### **レベル2: システム復旧**
```
対象: 複数機能に影響する問題

1. 影響範囲の正確な特定
2. 依存関係の確認
3. 段階的復旧計画作成
4. バックアップからの部分復旧
5. 段階的動作確認
```

### **レベル3: 完全復旧**  
```
対象: システム全体に影響する重大問題

1. 全システム停止・現状固定
2. ARCHIVE/から完全復旧
3. 段階的機能復旧
4. 全機能動作確認  
5. ユーザー承認後運用再開
```

---

## 📋 **予防措置**

### **日常チェック**
```
毎日実行:
□ 重要ファイルの存在確認
□ システム動作の簡易テスト  
□ エラーログの確認
□ バックアップ状況確認
```

### **定期メンテナンス**
```
週1回実行:
□ 全データベース整合性チェック
□ 品質基準の再確認
□ パフォーマンス測定
□ セキュリティチェック

月1回実行:  
□ 完全バックアップ作成
□ システム最適化
□ ドキュメント更新
□ 改善点の検討・実装
```

---

## 📞 **エスカレーション手順**

### **レベル1: 軽微な問題**
```
対応時間: 30分以内
担当: 当該Claude Code
報告: 解決後にユーザーへ報告
```

### **レベル2: 中程度の問題**  
```
対応時間: 2時間以内
担当: 継承Claude Code + ユーザー確認
報告: 対処中・完了時の2回報告
```

### **レベル3: 重大な問題**
```
対応時間: 即座
担当: ユーザー主導 + Claude Code支援
報告: リアルタイム状況報告
```

---

## 📝 **インシデント記録**

### **記録必須項目**
```
1. 発生日時・継続時間
2. 問題の詳細症状
3. 推定原因・根本原因
4. 対処手順・結果
5. 再発防止策  
6. 学習ポイント
```

### **記録保存先**  
```
INTEGRATED-SYSTEM/OUTPUT/incident-reports/
ファイル命名: incident_YYYY-MM-DD_概要.md
```

---

**このマニュアルにより、あらゆるトラブルに迅速・的確に対応できます。**

---

**作成者**: 次世代Claude Code  
**作成日**: 2025-09-03  
**バージョン**: v1.0（統合ディレクトリ対応版）  
**更新頻度**: インシデント発生時・改善時